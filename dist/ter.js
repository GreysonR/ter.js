/*! For license information please see ter.js.LICENSE.txt */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("ter",[],e):"object"==typeof exports?exports.ter=e():t.ter=e()}(self,(()=>{return t={"./src/bodies/Bodies.js":(t,e,i)=>{const s=t.exports,{isClass:r}=i("./src/core/Common.js");s.RigidBody=i("./src/physics/RigidBody.js"),s.Rectangle=i("./src/bodies/Rectangle.js"),s.createBodyFactory=function(t){let e={};for(let i in s)r(s[i])&&(e[i]=function(...e){return new s[i](t,...e)});return e}},"./src/bodies/Rectangle.js":(t,e,i)=>{const s=i("./src/physics/RigidBody.js"),r=i("./src/geometry/vec.js"),n=i("./src/render/PolygonRender.js"),o=i("./src/render/Sprite.js");t.exports=class t extends s{static createVertices(t,e){return[new r(-t/2,e/2),new r(t/2,e/2),new r(t/2,-e/2),new r(-t/2,-e/2)]}constructor(e,i,s,r,n={}){super(e,t.createVertices(i,s),r,n),this.width=i,this.height=s,this.type="rectangle"}addPolygonRender(t,e){let i=new n({container:t,position:new r(this.position),vertices:this.vertices,type:"rectangle",width:this.width,height:this.height,...e});return this.added&&i.add(),this.addChild(i),this}addSprite(t,e){let i=new o({container:t,position:new r(this.position),width:this.width,height:this.height,...e});return this.added&&i.add(),this.addChild(i),this}}},"./src/core/Common.js":(t,e,i)=>{const s=i("./src/geometry/vec.js");let r=t.exports={clamp:function(t,e,i){return Math.max(e,Math.min(t,i))},angleDiff:function(t,e){return i=t-e+Math.PI,s=2*Math.PI,i-Math.floor(i/s)*s-Math.PI;var i,s},modDiff:function(t,e,i=1){return r=i,(s=t-e+i/2)-Math.floor(s/r)*r-i/2;var s,r},pair:function(t,e){return t>e?t*t+t+e:e*e+t},unpair:function(t){let e=Math.floor(Math.sqrt(t)),i=t-e*e;return i<e?new s(i,e):new s(e,i-e)},pairCommon:function(t,e){return t>e?t*t+t+e:e*e+e+t},getCenterOfMass(t){let e=new s(0,0),i=0,r=0,n=t.length;for(let s=0;s<t.length;s++){let o=t[s],a=t[(s+1)%n];r=o.x*a.y-a.x*o.y,i+=r,e.add2({x:(o.x+a.x)*r,y:(o.y+a.y)*r})}return e.div2(3*i),e},parseColor:function(t){if("transparent"===t)return["#000000",0];let e,i=1;return"#"===t[0]&&9===t.length?(e=t.slice(0,7),i=parseInt(t.slice(7),16)/256):"#"===t[0]&&7===t.length?(e=t,i=1):"rgb("===t.slice(0,4)?(e=t.slice(t.indexOf("(")+1,t.indexOf(")")).split(","),e="#"+e.map((t=>parseInt(t).toString(16).padStart(2,"0"))).join(""),i=1):"rgba("===t.slice(0,5)&&(e=t.slice(t.indexOf("(")+1,t.indexOf(")")).split(","),i=parseInt(e.pop())/255,e="#"+e.map((t=>parseInt(t).toString(16).padStart(2,"0"))).join("")),[e,i]},merge:function(t,e,i=1/0,s=new WeakSet){s.add(e),Object.keys(e).forEach((n=>{let o=e[n];if(Array.isArray(o))t[n]=[...o];else if("object"==typeof o&&null!==o)if(i>1){if(s.has(o))return void(t[n]=o);"object"!=typeof t[n]&&(t[n]={}),r.merge(t[n],o,i-1,s)}else t[n]=o;else t[n]=o}))},isClass:function(t){const e=t.constructor&&"class"===t.constructor.toString().substring(0,5);if(void 0===t.prototype)return e;const i=t.prototype.constructor&&t.prototype.constructor.toString&&"class"===t.prototype.constructor.toString().substring(0,5);return e||i},lineIntersects:function(t,e,i,r){t.x!==e.x&&t.y!==e.y||(t=new s(t)),i.x!==r.x&&i.y!==r.y||(i=new s(i)),t.x===e.x&&(t.x+=1e-5),i.x===r.x&&(i.x+=1e-5),t.y===e.y&&(t.y+=1e-5),i.y===r.y&&(i.y+=1e-5);let n=(t.x-e.x)*(i.y-r.y)-(t.y-e.y)*(i.x-r.x);if(0===n)return!1;let o=(t.x*e.y-t.y*e.x)*(i.x-r.x)-(t.x-e.x)*(i.x*r.y-i.y*r.x),a=(t.x*e.y-t.y*e.x)*(i.y-r.y)-(t.y-e.y)*(i.x*r.y-i.y*r.x),l=new s(o/n,a/n),h=l.x>Math.min(t.x,e.x)&&l.x<Math.max(t.x,e.x)&&l.x>Math.min(i.x,r.x)&&l.x<Math.max(i.x,r.x),d=l.y>Math.min(t.y,e.y)&&l.y<Math.max(t.y,e.y)&&l.y>Math.min(i.y,r.y)&&l.y<Math.max(i.y,r.y);return h&&d?l:null},lineIntersectsBody:function(t,e,i){if(i.children.length>0){for(let s of i.children)if(r.lineIntersectsBody(t,e,s))return!0;return!1}let s=e.sub(t).normalize(),n=[s,s.normal()],o=[t,e];function a(t,e,i){for(let s of i){let i={min:1/0,max:-1/0},r={min:1/0,max:-1/0};for(let e of t){let t=e.dot(s);t<i.min&&i.minVertice,i.min=Math.min(i.min,t),i.max=Math.max(i.max,t)}for(let t of e){let e=t.dot(s);r.min=Math.min(r.min,e),r.max=Math.max(r.max,e)}if(i.min>r.max||i.max<r.min)return!1}return!0}return a(o,i.vertices,n)&&a(o,i.vertices,i.axes)},getRayNearbyStaticBodies(t,e,i){let r=i.staticGrid,n=r.gridSize,o={min:t.min(e).div2(n).floor2(),max:t.max(e).div2(n).floor2()};bodies=new Set;for(let t=o.min.x;t<=o.max.x;t++)for(let e=o.min.y;e<=o.max.y;e++){let i=r.pair(new s(t,e)),n=r.grid[i];if(n)for(let t of n)bodies.has(t)||bodies.add(t)}},getRayNearbyDynamicBodies(t,e,i){let r=i.dynamicGrid,n=r.gridSize,o={min:t.min(e).div2(n).floor2(),max:t.max(e).div2(n).floor2()};bodies=new Set;for(let t=o.min.x;t<=o.max.x;t++)for(let e=o.min.y;e<=o.max.y;e++){let i=r.pair(new s(t,e)),n=r.grid[i];if(n)for(let t of n)bodies.has(t)||bodies.add(t)}},raycast:function(t,e,i){let s=r.lineIntersects,n=1/0,o=null,a=null,l=-1;for(let r=0;r<i.length;r++){let h=i[r],{vertices:d}=h,c=d.length;for(let i=0;i<c;i++){let r=s(t,e,d[i],d[(i+1)%c]);if(r){let e=r.sub(t).length;e<n&&(n=e,o=r,a=h,l=i)}}}return{collision:null!==o,distance:n,point:o,body:a,verticeIndex:l}},raycastSimple:function(t,e,i){let s=r.lineIntersectsBody;for(let r of i)if(s(t,e,r))return!0;return!1},boundCollision:function(t,e){return t.max.x>=e.min.x&&t.min.x<=e.max.x&&t.max.y>=e.min.y&&t.min.y<=e.max.y},pointInBounds:function(t,e){return t.x>=e.min.x&&t.x<=e.max.x&&t.y>=e.min.y&&t.y<=e.max.y},arrayDelete(t,e){let i=t.indexOf(e);-1!==i&&t.splice(i,1)}}},"./src/core/Game.js":(t,e,i)=>{const s=i("./src/node/World.js"),r=i("./src/render/Render.js"),n=i("./src/render/DebugRender.js"),o=i("./src/physics/Engine.js"),a=i("./src/core/Common.js"),l=i("./src/render/PerformanceRender.js"),h=i("./src/core/Ticker.js"),d=i("./src/bodies/Bodies.js");t.exports=class t{static defaultOptions={World:s.defaultOptions,Render:r.defaultOptions,Engine:o.defaultOptions,Ticker:h.defaultOptions};constructor(e={}){let i={...t.defaultOptions};a.merge(i,e,2),e=i,this.World=new s(e.World),this.Engine=new o(this.World,e.Engine),this.Render=new r(e.Render),this.Ticker=new h(this,e.Ticker),this.Bodies=d.createBodyFactory(this.Engine)}createDebugRender(){this.DebugRender=new n(this);let t=this.Engine.Performance;t.render=new l(t,this.Render),t.render.enabled=!0}}},"./src/core/Performance.js":(t,e,i)=>{const s=i("./src/render/PerformanceRender.js");t.exports=class{getAvgs=!0;lastUpdate=0;fps=60;delta=1;frame=0;history={avgFps:60,avgDelta:1,fps:[],delta:[]};engine={delta:0,lastUpdate:0};constructor(t=void 0){t&&(this.render=new s(this,t)),this.lastUpdate=performance.now()/1e3}update(){let t=performance.now()/1e3;if(t-this.lastUpdate==0)return;this.delta=Math.min(5,t-this.lastUpdate),this.fps=1/this.delta,this.lastUpdate=t,this.history.fps.push(this.fps),this.history.delta.push(this.delta),this.history.fps.length>200&&(this.history.fps.shift(),this.history.delta.shift());let e=(()=>{let t=0;for(let e=0;e<this.history.fps.length;e++)t+=this.history.fps[e];return t/this.history.fps.length})(),i=(()=>{let t=0;for(let e=0;e<this.history.delta.length;e++)t+=this.history.delta[e];return t/this.history.delta.length})();this.history.avgFps=e,this.history.avgDelta=i}}},"./src/core/Ticker.js":(t,e,i)=>{const s=i("./src/core/Common.js");t.exports=class t{static defaultOptions={pauseOnFreeze:!0,freezeThreshold:.3};constructor(e,i={}){let r={...t.defaultOptions};s.merge(r,i,1),i=r,this.Game=e,this.pauseOnFreeze=i.pauseOnFreeze,this.freezeThreshold=i.freezeThreshold,this.tick=this.tick.bind(this),window.addEventListener("load",this.tick)}tick(){this.trigger("beforeTick");const{Engine:t}=this.Game,{Performance:e}=t;this.pauseOnFreeze&&e.fps/Math.max(1,e.history.avgFps)<this.freezeThreshold?e.update():t.update(),this.trigger("afterTick"),requestAnimationFrame(this.tick)}#t={beforeTick:[],afterTick:[]};on(t,e){this.#t[t]?this.#t[t].push(e):console.warn(t+" is not a valid event")}off(t,e){(t=this.#t[t]).includes(e)&&t.splice(t.indexOf(e),1)}trigger(t){this.#t[t]&&this.#t[t].forEach((t=>{t()}))}}},"./src/extra/BehaviorTree.js":t=>{"use strict";class e{static FAILURE=0;static SUCCESS=1;static globalTrees={};static call(t,e,i={}){let s=this.globalTrees[t];if(!s)throw new Error(`No registered tree of name: ${t}`);s.tick(i).then((t=>e(t)))}static nodes={};static parse(t){let i;if("string"==typeof t){if(!e.globalTrees[t])throw new Error("No registered tree of name: "+t);t=e.globalTrees[t]}let s={};if(Common.merge(s,t),t=s,i=e.nodes[t.type??t.toString()],!i)throw new Error("No node of type: "+t.type+", "+t);if(t.child&&(t.child=e.parse(t.child)),t.children)for(let i=0;i<t.children.length;++i)t.children[i]=e.parse(t.children[i]);return new i(t,t?.blackboard)}static registerType(t){this.nodes[t]=t}static registerTree(t,e){this.globalTrees[t]=e}static toString(){return"BehaviorTree"}static id=-1;blackboard={};head=null;constructor(t,i={}){this.id=++e.id,this.toString=e.toString,this.blackboard=i,"BehaviorTree"===(t.type??t.toString())?(this.blackboard=t.blackboard,this.head=e.parse(t.head)):this.head=e.parse(t)}tick(t=this.blackboard){return this.head.tick(t)}interrupt(t=e.FAILURE){this.head.interrupt(t)}}e.registerType(e),t.exports.BehaviorTree=e;class i{static toString(){return"Composite"}constructor({children:t=[]}){this.id=++e.id,this.children=t,this.toString=i.toString}interrupt(t=e.FAILURE){for(let e of this.children)e.interrupt(t);this.resolve&&(this.hasInterrupt=!0,this.resolve(t))}}e.registerType(i),t.exports.Composite=i;class s extends i{static toString(){return"Sequence"}constructor(t){super(t),this.toString=s.toString}tick(t){let i=this.children,s=this;return new Promise((r=>{this.resolve=r;let n=0;!function o(){i[n].tick(t).then((t=>{s.hasInterrupt?s.hasInterrupt=!1:t==e.SUCCESS?++n>=i.length?r(e.SUCCESS):o():r(t)}))}()}))}}e.registerType(s),t.exports.Sequence=s;class r extends i{static toString(){return"Selector"}constructor(t){super(t),this.toString=r.toString}tick(t){let i=this,s=this.children;return new Promise(((r,n)=>{this.resolve=r;let o=0;!function n(){s[o].tick(t).then((t=>{i.hasInterrupt?i.hasInterrupt=!1:t==e.SUCCESS?r(t):++o>=s.length?r(e.FAILURE):n()}))}()}))}}e.registerType(r),t.exports.Selector=r;class n{static toString(){return"Decorator"}constructor({child:t}){this.id=++e.id,this.child=t,this.toString=n.toString}interrupt(t=e.FAILURE){this.child.interrupt(t),this.resolve&&(this.resolve(t),this.hasInterrupt=!0)}}e.registerType(n),t.exports.Decorator=n;class o extends n{static toString(){return"Inverter"}constructor(t){super(t),this.toString=o.toString}tick(t){let e=this;return new Promise((i=>{e.hasInterrupt?e.hasInterrupt=!1:(this.resolve=i,this.child.tick(t).then((t=>{i(Number(!t))})))}))}}e.registerType(o),t.exports.Inverter=o;class a extends n{static toString(){return"Succeeder"}constructor(t){super(t),this.toString=a.toString}tick(t){let i=this.child,s=this;return new Promise((r=>{this.resolve=r,i.tick(t).then((t=>{s.hasInterrupt?s.hasInterrupt=!1:r(e.SUCCESS)}))}))}}e.registerType(a),t.exports.Succeeder=a;class l extends n{static toString(){return"Repeat"}count=3;constructor(t){super(t),this.toString=l.toString,this.count=t.count??3}tick(t){let i=this,s=0,r=this.count,n=this.child;return new Promise((o=>{this.resolve=o,function a(){n.tick(t).then((t=>{i.hasInterrupt?i.hasInterrupt=!1:++s>=r?o(e.SUCCESS):a()}))}()}))}}e.registerType(l),t.exports.Repeat=l;class h extends n{static toString(){return"RepeatUntilFail"}count=1/0;constructor(t){super(t),this.toString=h.toString,this.count=t.count??1/0}tick(t){let i=0,s=this.count,r=this.child,n=this;return new Promise((o=>{this.resolve=o,function a(){r.tick(t).then((t=>{n.hasInterrupt?n.hasInterrupt=!1:t==e.FAILURE||++i>=s?o(e.SUCCESS):a()}))}()}))}}e.registerType(h),t.exports.RepeatUntilFail=h;class d{static toString(){return"Leaf"}constructor({callback:t}){this.id=++e.id,this.callback=t,this.toString=d.toString}tick(t){return new Promise((e=>{this.resolve=e,this.callback(e,t)}))}interrupt(t=e.FAILURE){this.resolve&&this.resolve(t)}}e.registerType(d),t.exports.Leaf=d},"./src/extra/GameFunctions.js":(t,e,i)=>{const s=i("./src/geometry/vec.js");t.exports={getVoronoiRegion:function(t,e){let{vertices:i}=t,s=i.length;for(let t=0;t<s;t++){let r=i[t],n=i[(t+1)%s].sub(r),o=n.normalize(),a=o.normal(),l=e.sub(r),h=l.dot(a)>=-10,d=l.dot(o),c=d>=0&&d<=n.length;if(h&&c)return[t,(t+1)%s];{let e=i[(t-1+s)%s].sub(r).normalize();if(l.dot(e)<0&&d<0)return[t]}}return[]},closestPointBetweenBodies:function(t,e){let i=t.vertices,r=e.vertices,n=null,o=1/0;for(let t=0;t<i.length;t++){let a=i[t],l=getVoronoiRegion(e,a);if(l.length>0){let t;if(1===l.length)t=new s(r[l[0]]);else if(2===l.length){let e=r[l[0]],i=r[l[1]].sub(e).normalize();t=i.mult(i.dot(a.sub(e))).add(e)}let e=t.sub(a).length;e<o&&(o=e,n=t)}}return n},closestEdgeBetweenBodies:function(t,e){let i=t.vertices,r=e.vertices,n=null,o=new s(1,0),a=1/0;for(let t=0;t<i.length;t++){let l=i[t],h=getVoronoiRegion(e,l);if(h.length>0){let t,e;if(1===h.length){t=new s(r[h[0]]);let i=r[(h[0]-1+r.length)%r.length],n=r[(h[0]+1)%r.length],o=t.sub(i).normalize(),a=n.sub(t).normalize();e=o.add(a).normalize()}else if(2===h.length){let i=r[h[0]],s=r[h[1]].sub(i).normalize();t=s.mult(s.dot(l.sub(i))).add(i),e=s}let i=t.sub(l).length;i<a&&(a=i,n=t,o=e.normal())}}return{point:n,normal:o}},createGradient:function(t,e,i=[["#ff0000ff",0],["#ff000000",1]]){let s=ctx.createLinearGradient(t.x,t.y,e.x,e.y);for(let t of i)s.addColorStop(t[1],t[0]);return s},createRadialGradient:function(t,e,i=[["#ff0000ff",0],["#ff000000",1]]){let s=ctx.createRadialGradient(t.x,t.y,0,t.x,t.y,e);for(let t of i)s.addColorStop(t[1],t[0]);return s},createElement:function(t,e){let i=document.createElement(t);return function t(e,i){Object.keys(i).forEach((s=>{if("object"!=typeof i[s]||Array.isArray(s)||i[s]instanceof Element)if("class"===s){let t="string"==typeof i[s]?i[s].split(" "):i[s];for(let i of t)e.classList.add(i)}else"parent"===s?i[s].appendChild(e):e[s]=i[s];else t(e[s],i[s])}))}(i,e),i},gaussianRandom:function(t=0,e=1,i=Math.random){let s=1-i(),r=i();return Math.sqrt(-2*Math.log(s))*Math.cos(2*Math.PI*r)*e+t},createSeededRandom:function(t){var e=4294967295,i=123456789+t&e,s=987654321-t&e;return function(){return(((s=36969*(65535&s)+(s>>16)&e)<<16)+(65535&(i=18e3*(65535&i)+(i>>16)&e))>>>0)/4294967296}},setCSSVariable:function(t,e){root.style.setProperty(`--${t}`,e)},boundedRandom:function([t,e]){return Math.random()*(e-t)+t},boundedRandomPoint:function(t){return new s(boundedRandom([t.min.x,t.max.x]),boundedRandom([t.min.y,t.max.y]))},getMovementDirections:function(t,e=.5){let i={};return(t=t.normalize()).x>e?i.right=!0:t.x<-e&&(i.left=!0),t.y>e?i.down=!0:t.y<-e&&(i.up=!0),i},setMovementDirections:function(t,e){for(let i of Object.keys(e))t[i]=e[i]},createTilingArea:function(t,e){let i=PIXI.Texture.from(e),{angle:s,position:r}=t;t.setAngle(0);let n=t.bounds.max.sub(t.bounds.min),o=new PIXI.TilingSprite(i,n.x,n.y);o.zIndex=-1,mainWorld.addChild(o);let a=n.mult(-.5),l=r.add(a.rotate(s));return o.rotation=s,o.position.set(l.x,l.y),o.spritePos=a,o.delete=function(){mainWorld.removeChild(o),o.destroy()},t.setAngle(s),o}}},"./src/geometry/Bezier.js":t=>{"use strict";t.exports=class{constructor(t,e,i,s){t.a&&t.b?(this.a=new vec(t.a),this.b=new vec(t.b),this.c=new vec(t.c),this.d=new vec(t.d)):(this.a=new vec(t),this.b=new vec(e),this.c=new vec(i),this.d=new vec(s)),this.length=this.getLength()}getAtT(t){let e=this.a.x*(1-t)**3+3*this.b.x*t*(1-t)**2+3*this.c.x*(1-t)*t**2+this.d.x*t**3,i=this.a.y*(1-t)**3+3*this.b.y*t*(1-t)**2+3*this.c.y*(1-t)*t**2+this.d.y*t**3;return new vec(e,i)}getLength(t=.01){let e=this.getAtT(0),i=0;for(let s=t;s<=1;s+=t){let t=this.getAtT(s);i+=t.sub(e).length,e=t}return i+=this.getAtT(1).sub(e).length,i}get(t){return this.getAtT(t/this.length)}getDxAtT(t){let e=3*((this.d.x-3*this.c.x+3*this.b.x-this.a.x)*t**2+(2*this.c.x-4*this.b.x+2*this.a.x)*t+this.b.x-this.a.x),i=3*((this.d.y-3*this.c.y+3*this.b.y-this.a.y)*t**2+(2*this.c.y-4*this.b.y+2*this.a.y)*t+this.b.y-this.a.y);return new vec(e,i)}getDx(t){return this.getDxAtT(t/this.length)}getDx2AtT(t){let e=6*((this.d.x-3*this.c.x+3*this.b.x-this.a.x)*t+this.c.x-2*this.b.x+this.a.x),i=6*((this.d.y-3*this.c.y+3*this.b.y-this.a.y)*t+this.c.y-2*this.b.y+this.a.y);return new vec(e,i)}getDx2(t){return this.getDx2AtT(t/this.length)}render(){ctx.beginPath();for(let t=0;t<this.length;t+=10){let e=this.get(t);0===t?ctx.moveTo(e.x,e.y):ctx.lineTo(e.x,e.y)}ctx.strokeStyle="#ff0000",ctx.lineWidth=1/camera.scale,ctx.stroke()}renderDx(){ctx.strokeStyle="#000000",ctx.lineWidth=1/camera.scale;for(let t=10;t<this.length;t+=10){let e=this.get(t),i=this.get(t-10);ctx.lineWidth=this.getDx(t).length**2*1e-4/camera.scale,ctx.beginPath(),ctx.moveTo(i.x,i.y),ctx.lineTo(e.x,e.y),ctx.stroke()}}toObject(){return{a:this.a.toObject(),b:this.b.toObject(),c:this.c.toObject(),d:this.d.toObject()}}}},"./src/geometry/Bounds.js":(t,e,i)=>{const s=i("./src/geometry/vec.js");t.exports=class{min=new s(0,0);max=new s(0,0);constructor(t,e){Array.isArray(t)?this.update(t):t.min&&t.max?(this.min.set(t.min),this.max.set(t.max)):(this.min.set(t),this.max.set(e))}update(t){let e=1/0,i=1/0,s=-1/0,r=-1/0;for(let n=0;n<t.length;n++){let o=t[n];o.x<e&&(e=o.x),o.x>s&&(s=o.x),o.y<i&&(i=o.y),o.y>r&&(r=o.y)}this.min.x=e,this.min.y=i,this.max.x=s,this.max.y=r}randomPoint(){}}},"./src/geometry/Grid.js":(t,e,i)=>{"use strict";const{arrayDelete:s}=i("./src/core/Common.js");t.exports=class t{static id=0;grid={};gridIds=new Set;gridSize=2e3;constructor(e=2e3){this.gridSize=e,this.id=t.id++}pair=function(t){let e=t.x>=0?2*t.x:-2*t.x-1,i=t.y>=0?2*t.y:-2*t.y-1;return e>=i?e*e+e+i:i*i+e};unpair=function(t){let e=Math.floor(Math.sqrt(t)),i=e*e,s=t-i>=e?new vec(e,t-i-e):new vec(t-i,e),r=s.x%2==0?s.x/2:(s.x+1)/-2,n=s.y%2==0?s.y/2:(s.y+1)/-2;return new vec(r,n)};getBounds=function(t){let e=this.gridSize;if("object"==typeof t.bounds)return{min:t.bounds.min.div(e).floor2(),max:t.bounds.max.div(e).floor2()};if(void 0!==t.x&&void 0!==t.y){let i=Math.floor(t.x/e),s=Math.floor(t.y/e);return{min:new vec(i,s),max:new vec(i,s)}}};getBucketIds=function(t){let e=[];for(let i=t.min.x;i<=t.max.x;i++)for(let s=t.min.y;s<=t.max.y;s++){let t=this.pair(new vec(i,s));this.grid[t]&&e.push(t)}return e};addBody=function(t){let e=this.getBounds(t);t._Grids||(t._Grids={}),t._Grids[this.id]||(t._Grids[this.id]=[]);for(let i=e.min.x;i<=e.max.x;i++)for(let s=e.min.y;s<=e.max.y;s++){let e=this.pair(new vec(i,s));t._Grids[this.id].push(e),this.grid[e]||(this.grid[e]=[],this.gridIds.add(e)),this.grid[e].push(t)}};removeBody=function(t){for(let e of t._Grids[this.id]){let i=this.grid[e];i&&(s(i,t),0===i.length&&(delete this.grid[e],this.gridIds.delete(e)))}};addPoint=function(t){t._Grids||(t._Grids={}),t._Grids[this.id]||(t._Grids[this.id]=[]);let e=(t.x?t:t.position).div(this.gridSize).floor2(),i=this.pair(e);t._Grids[this.id].push(i),this.grid[i]||(this.grid[i]=[],this.gridIds.add(i)),this.grid[i].push(t)};removePoint=function(t){t._Grids||console.log(t._Grids);for(let e of t._Grids[this.id]){let i=this.grid[e];i&&(s(i,t),0===i.length&&(delete this.grid[e],this.gridIds.delete(e)))}};updateBody=function(t){let e=t._Grids[this.id],i=new Set(e),r=this.getBounds(t);for(let s=r.min.x;s<=r.max.x;s++)for(let n=r.min.y;n<=r.max.y;n++){let r=this.pair(new vec(s,n));i.has(r)?i.delete(r):(e.push(r),this.grid[r]||(this.grid[r]=[],this.gridIds.add(r)),this.grid[r].push(t))}for(let r of i){let i=this.grid[r];s(e,r),i&&(s(i,t),0===i.length&&(delete this.grid[r],this.gridIds.delete(r)))}}}},"./src/geometry/vec.js":t=>{t.exports=class t{constructor(t,e){return"object"==typeof t?Array.isArray(t)?(this.x=t[0],this.y=t[1]):(this.x=t.x,this.y=t.y):"number"==typeof t&&void 0===e?(this.x=Math.cos(t),this.y=Math.sin(t)):(this.x=t,this.y=e),this}add(e){return"number"==typeof e?new t(this.x+e,this.y+e):new t(this.x+e.x,this.y+e.y)}sub(e){return"number"==typeof e?new t(this.x-e,this.y-e):new t(this.x-e.x,this.y-e.y)}mult(e){return"number"==typeof e?new t(this.x*e,this.y*e):new t(this.x*e.x,this.y*e.y)}div(e){return"number"==typeof e?new t(this.x/e,this.y/e):new t(this.x/e.x,this.y/e.y)}add2(t){return"number"==typeof t?(this.x+=t,this.y+=t,this):(this.x+=t.x,this.y+=t.y,this)}sub2(t){return"number"==typeof t?(this.x-=t,this.y-=t,this):(this.x-=t.x,this.y-=t.y,this)}mult2(t){return"number"==typeof t?(this.x*=t,this.y*=t,this):(this.x*=t.x,this.y*=t.y,this)}div2(t){return"number"==typeof t?(this.x/=t,this.y/=t,this):(this.x/=t.x,this.y/=t.y,this)}pow(e){return"number"==typeof e?new t(this.x**e,this.y**e):new t(this.x**e.x,this.y**e.y)}pow2(t){return"number"==typeof t?(this.x=this.x**t,this.y=this.y**t,this):(this.x=this.x**t.x,this.y=this.y**t.y,this)}sign(){return new t(Math.sign(this.x),Math.sign(this.y))}sign2(){return this.x=Math.sign(this.x),this.y=Math.sign(this.y),this}mod(e){return"number"==typeof e?new t(this.x%e,this.y%e):new t(this.x%e.x,this.y%e.y)}mod2(t){return"number"==typeof t?(this.x%=t,this.y%=t):(this.x%=t.x,this.y%=t.y),this}dot(t){return this.x*t.x+this.y*t.y}cross(e){return"number"==typeof e?new t(-e*this.y,e*this.x):this.x*e.y-this.y*e.x}avg(e,i=.5){let s=1-i;return new t(this.x*i+e.x*s,this.y*i+e.y*s)}get length(){return Math.sqrt(this.x*this.x+this.y*this.y)}set length(t){let e=t/this.length;return this.x*=e,this.y*=e,this}get angle(){return Math.atan2(this.y,this.x)}get area(){return this.x*this.y}manhattan(t){return Math.abs(t.x-this.x)+Math.abs(t.y-this.y)}abs(){return new t(Math.abs(this.x),Math.abs(this.y))}abs2(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this}reflect(t){let e=t.normal();return this.sub(e.mult(2*e.dot(this)))}reflect2(t){let e=t.normal();return this.sub2(e.mult(2*e.dot(this)))}rotate(e){return new t(Math.cos(e)*this.x-Math.sin(e)*this.y,Math.sin(e)*this.x+Math.cos(e)*this.y)}rotate2(t){let e=Math.cos(t)*this.x-Math.sin(t)*this.y;return this.y=Math.sin(t)*this.x+Math.cos(t)*this.y,this.x=e,this}project(e,i=!1){let s=this.dot(e),r=e.x*e.x+e.y*e.y;return i&&(s=Math.max(0,Math.min(r,s))),new t(s*e.x/r,s*e.y/r)}project2(t,e=!1){let i=this.dot(t),s=t.x*t.x+t.y*t.y;return e&&(i=Math.max(0,Math.min(s,i))),this.x=i*t.x/s,this.y=i*t.y/s,this}normalize(){let e=this.length;return 0===e?new t(this):new t(this.x/e,this.y/e)}normalize2(){let t=this.length;return 0===t||(this.x/=t,this.y/=t),this}normal(){return new t(this.y,-this.x)}normal2(){let t=this.y;return this.y=-this.x,this.x=t,this}floor(){return new t(Math.floor(this.x),Math.floor(this.y))}floor2(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return new t(Math.ceil(this.x),Math.ceil(this.y))}ceil2(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return new t(Math.round(this.x),Math.round(this.y))}round2(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}min(e){return new t(Math.min(e.x,this.x),Math.min(e.y,this.y))}min2(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(e){return new t(Math.max(e.x,this.x),Math.max(e.y,this.y))}max2(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(e,i){return new t(Math.max(e.x,Math.min(i.x,this.x)),Math.max(e.y,Math.min(i.y,this.y)))}clamp2(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}equals(t){return this.x===t.x&&this.y===t.y}set(t){return this.x=t.x,this.y=t.y,this}toString(){return`{ x: ${this.x}, y: ${this.y} }`}toStringInt(){return`{ x: ${Math.round(this.x)}, y: ${Math.round(this.y)} }`}toObject(){return{x:this.x,y:this.y}}toArray(){return[this.x,this.y]}isNaN(){return isNaN(this.x)||isNaN(this.y)}}},"./src/lib/poly-decomp.js":t=>{function e(t,e,i){i=i||0;var s,r,n,o,a,l,h,d=[0,0];return s=t[1][1]-t[0][1],r=t[0][0]-t[1][0],n=s*t[0][0]+r*t[0][1],o=e[1][1]-e[0][1],a=e[0][0]-e[1][0],l=o*e[0][0]+a*e[0][1],M(h=s*a-o*r,0,i)||(d[0]=(a*n-r*l)/h,d[1]=(s*l-o*n)/h),d}function i(t,e,i,s){var r=e[0]-t[0],n=e[1]-t[1],o=s[0]-i[0],a=s[1]-i[1];if(o*n-a*r==0)return!1;var l=(r*(i[1]-t[1])+n*(t[0]-i[0]))/(o*n-a*r),h=(o*(t[1]-i[1])+a*(i[0]-t[0]))/(a*r-o*n);return l>=0&&l<=1&&h>=0&&h<=1}function s(t,e,i){return(e[0]-t[0])*(i[1]-t[1])-(i[0]-t[0])*(e[1]-t[1])}function r(t,e,i){return s(t,e,i)>0}function n(t,e,i){return s(t,e,i)>=0}function o(t,e,i){return s(t,e,i)<0}function a(t,e,i){return s(t,e,i)<=0}t.exports={decomp:function(t){var e=b(t);return e.length>0?w(t,e):[t]},quickDecomp:function t(e,i,s,l,h,d,y){d=d||100,y=y||0,h=h||25,i=void 0!==i?i:[],s=s||[],l=l||[];var p=[0,0],m=[0,0],v=[0,0],b=0,w=0,M=0,C=0,j=0,I=0,P=0,R=[],k=[],A=e,T=e;if(T.length<3)return i;if(++y>d)return console.warn("quickDecomp: max level ("+d+") reached."),i;for(var z=0;z<e.length;++z)if(g(A,z)){s.push(A[z]),b=w=Number.MAX_VALUE;for(var B=0;B<e.length;++B)r(u(A,z-1),u(A,z),u(A,B))&&a(u(A,z-1),u(A,z),u(A,B-1))&&(v=S(u(A,z-1),u(A,z),u(A,B),u(A,B-1)),o(u(A,z+1),u(A,z),v)&&(M=c(A[z],v))<w&&(w=M,m=v,I=B)),r(u(A,z+1),u(A,z),u(A,B+1))&&a(u(A,z+1),u(A,z),u(A,B))&&(v=S(u(A,z+1),u(A,z),u(A,B),u(A,B+1)),r(u(A,z-1),u(A,z),v)&&(M=c(A[z],v))<b&&(b=M,p=v,j=B));if(I===(j+1)%e.length)v[0]=(m[0]+p[0])/2,v[1]=(m[1]+p[1])/2,l.push(v),z<j?(f(R,A,z,j+1),R.push(v),k.push(v),0!==I&&f(k,A,I,A.length),f(k,A,0,z+1)):(0!==z&&f(R,A,z,A.length),f(R,A,0,j+1),R.push(v),k.push(v),f(k,A,I,z+1));else{if(I>j&&(j+=e.length),C=Number.MAX_VALUE,j<I)return i;for(B=I;B<=j;++B)n(u(A,z-1),u(A,z),u(A,B))&&a(u(A,z+1),u(A,z),u(A,B))&&(M=c(u(A,z),u(A,B)))<C&&x(A,z,B)&&(C=M,P=B%e.length);z<P?(f(R,A,z,P+1),0!==P&&f(k,A,P,T.length),f(k,A,0,z+1)):(0!==z&&f(R,A,z,T.length),f(R,A,0,P+1),f(k,A,P,z+1))}return R.length<k.length?(t(R,i,s,l,h,d,y),t(k,i,s,l,h,d,y)):(t(k,i,s,l,h,d,y),t(R,i,s,l,h,d,y)),i}return i.push(e),i},isSimple:function(t){var e,s=t;for(e=0;e<s.length-1;e++)for(var r=0;r<e-1;r++)if(i(s[e],s[e+1],s[r],s[r+1]))return!1;for(e=1;e<s.length-2;e++)if(i(s[0],s[s.length-1],s[e],s[e+1]))return!1;return!0},removeCollinearPoints:function(t,e){for(var i=0,s=t.length-1;t.length>3&&s>=0;--s)d(u(t,s-1),u(t,s),u(t,s+1),e)&&(t.splice(s%t.length,1),i++);return i},removeDuplicatePoints:function(t,e){for(var i=t.length-1;i>=1;--i)for(var s=t[i],r=i-1;r>=0;--r)C(s,t[r],e)&&t.splice(i,1)},makeCCW:function(t){for(var e=0,i=t,s=1;s<t.length;++s)(i[s][1]<i[e][1]||i[s][1]===i[e][1]&&i[s][0]>i[e][0])&&(e=s);return!r(u(t,e-1),u(t,e),u(t,e+1))&&(function(t){for(var e=[],i=t.length,s=0;s!==i;s++)e.push(t.pop());for(s=0;s!==i;s++)t[s]=e[s]}(t),!0)}};var l=[],h=[];function d(t,e,i,r){if(r){var n=l,o=h;n[0]=e[0]-t[0],n[1]=e[1]-t[1],o[0]=i[0]-e[0],o[1]=i[1]-e[1];var a=n[0]*o[0]+n[1]*o[1],d=Math.sqrt(n[0]*n[0]+n[1]*n[1]),c=Math.sqrt(o[0]*o[0]+o[1]*o[1]);return Math.acos(a/(d*c))<r}return 0===s(t,e,i)}function c(t,e){var i=e[0]-t[0],s=e[1]-t[1];return i*i+s*s}function u(t,e){var i=t.length;return t[e<0?e%i+i:e%i]}function f(t,e,i,s){for(var r=i;r<s;r++)t.push(e[r])}function g(t,e){return o(u(t,e-1),u(t,e),u(t,e+1))}var y=[],p=[];function m(t,i,s){var r,o,l=y,h=p;if(n(u(t,i+1),u(t,i),u(t,s))&&a(u(t,i-1),u(t,i),u(t,s)))return!1;o=c(u(t,i),u(t,s));for(var d=0;d!==t.length;++d)if((d+1)%t.length!==i&&d!==i&&n(u(t,i),u(t,s),u(t,d+1))&&a(u(t,i),u(t,s),u(t,d))&&(l[0]=u(t,i),l[1]=u(t,s),h[0]=u(t,d),h[1]=u(t,d+1),r=e(l,h),c(u(t,i),r)<o))return!1;return!0}function x(t,e,s){for(var r=0;r!==t.length;++r)if(r!==e&&r!==s&&(r+1)%t.length!==e&&(r+1)%t.length!==s&&i(u(t,e),u(t,s),u(t,r),u(t,r+1)))return!1;return!0}function v(t,e,i,s){var r=s||[];if(function(t){t.length=0}(r),e<i)for(var n=e;n<=i;n++)r.push(t[n]);else{for(n=0;n<=i;n++)r.push(t[n]);for(n=e;n<t.length;n++)r.push(t[n])}return r}function b(t){for(var e=[],i=[],s=[],r=[],n=Number.MAX_VALUE,o=0;o<t.length;++o)if(g(t,o))for(var a=0;a<t.length;++a)if(m(t,o,a)){i=b(v(t,o,a,r)),s=b(v(t,a,o,r));for(var l=0;l<s.length;l++)i.push(s[l]);i.length<n&&(e=i,n=i.length,e.push([u(t,o),u(t,a)]))}return e}function w(t,e){if(0===e.length)return[t];if(e instanceof Array&&e.length&&e[0]instanceof Array&&2===e[0].length&&e[0][0]instanceof Array){for(var i=[t],s=0;s<e.length;s++)for(var r=e[s],n=0;n<i.length;n++){var o=w(i[n],r);if(o){i.splice(n,1),i.push(o[0],o[1]);break}}return i}return r=e,s=t.indexOf(r[0]),n=t.indexOf(r[1]),-1!==s&&-1!==n&&[v(t,s,n),v(t,n,s)]}function S(t,e,i,s,r){r=r||0;var n=e[1]-t[1],o=t[0]-e[0],a=n*t[0]+o*t[1],l=s[1]-i[1],h=i[0]-s[0],d=l*i[0]+h*i[1],c=n*h-l*o;return M(c,0,r)?[0,0]:[(h*a-o*d)/c,(n*d-l*a)/c]}function M(t,e,i){return i=i||0,Math.abs(t-e)<=i}function C(t,e,i){return M(t[0],e[0],i)&&M(t[1],e[1],i)}},"./src/lib/simplexNoise.js":function(){!function(t){var e=t.noise={};function i(t,e,i){this.x=t,this.y=e,this.z=i}i.prototype.dot2=function(t,e){return this.x*t+this.y*e},i.prototype.dot3=function(t,e,i){return this.x*t+this.y*e+this.z*i};var s=[new i(1,1,0),new i(-1,1,0),new i(1,-1,0),new i(-1,-1,0),new i(1,0,1),new i(-1,0,1),new i(1,0,-1),new i(-1,0,-1),new i(0,1,1),new i(0,-1,1),new i(0,1,-1),new i(0,-1,-1)],r=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],n=new Array(512),o=new Array(512);e.seed=function(t){t>0&&t<1&&(t*=65536),(t=Math.floor(t))<256&&(t|=t<<8);for(var e=0;e<256;e++){var i;i=1&e?r[e]^255&t:r[e]^t>>8&255,n[e]=n[e+256]=i,o[e]=o[e+256]=s[i%12]}},e.seed(0);var a=.5*(Math.sqrt(3)-1),l=(3-Math.sqrt(3))/6,h=1/6;function d(t){return t*t*t*(t*(6*t-15)+10)}function c(t,e,i){return(1-i)*t+i*e}e.simplex2=function(t,e){var i,s,r=(t+e)*a,h=Math.floor(t+r),d=Math.floor(e+r),c=(h+d)*l,u=t-h+c,f=e-d+c;u>f?(i=1,s=0):(i=0,s=1);var g=u-i+l,y=f-s+l,p=u-1+2*l,m=f-1+2*l,x=o[(h&=255)+n[d&=255]],v=o[h+i+n[d+s]],b=o[h+1+n[d+1]],w=.5-u*u-f*f,S=.5-g*g-y*y,M=.5-p*p-m*m;return 70*((w<0?0:(w*=w)*w*x.dot2(u,f))+(S<0?0:(S*=S)*S*v.dot2(g,y))+(M<0?0:(M*=M)*M*b.dot2(p,m)))},e.simplex3=function(t,e,i){var s,r,a,l,d,c,u=.3333333333333333*(t+e+i),f=Math.floor(t+u),g=Math.floor(e+u),y=Math.floor(i+u),p=(f+g+y)*h,m=t-f+p,x=e-g+p,v=i-y+p;m>=x?x>=v?(s=1,r=0,a=0,l=1,d=1,c=0):m>=v?(s=1,r=0,a=0,l=1,d=0,c=1):(s=0,r=0,a=1,l=1,d=0,c=1):x<v?(s=0,r=0,a=1,l=0,d=1,c=1):m<v?(s=0,r=1,a=0,l=0,d=1,c=1):(s=0,r=1,a=0,l=1,d=1,c=0);var b=m-s+h,w=x-r+h,S=v-a+h,M=m-l+2*h,C=x-d+2*h,j=v-c+2*h,I=m-1+.5,P=x-1+.5,R=v-1+.5,k=o[(f&=255)+n[(g&=255)+n[y&=255]]],A=o[f+s+n[g+r+n[y+a]]],T=o[f+l+n[g+d+n[y+c]]],z=o[f+1+n[g+1+n[y+1]]],B=.6-m*m-x*x-v*v,E=.6-b*b-w*w-S*S,G=.6-M*M-C*C-j*j,_=.6-I*I-P*P-R*R;return 32*((B<0?0:(B*=B)*B*k.dot3(m,x,v))+(E<0?0:(E*=E)*E*A.dot3(b,w,S))+(G<0?0:(G*=G)*G*T.dot3(M,C,j))+(_<0?0:(_*=_)*_*z.dot3(I,P,R)))},e.perlin2=function(t,e){var i=Math.floor(t),s=Math.floor(e);t-=i,e-=s;var r=o[(i&=255)+n[s&=255]].dot2(t,e),a=o[i+n[s+1]].dot2(t,e-1),l=o[i+1+n[s]].dot2(t-1,e),h=o[i+1+n[s+1]].dot2(t-1,e-1),u=d(t);return c(c(r,l,u),c(a,h,u),d(e))},e.perlin3=function(t,e,i){var s=Math.floor(t),r=Math.floor(e),a=Math.floor(i);t-=s,e-=r,i-=a;var l=o[(s&=255)+n[(r&=255)+n[a&=255]]].dot3(t,e,i),h=o[s+n[r+n[a+1]]].dot3(t,e,i-1),u=o[s+n[r+1+n[a]]].dot3(t,e-1,i),f=o[s+n[r+1+n[a+1]]].dot3(t,e-1,i-1),g=o[s+1+n[r+n[a]]].dot3(t-1,e,i),y=o[s+1+n[r+n[a+1]]].dot3(t-1,e,i-1),p=o[s+1+n[r+1+n[a]]].dot3(t-1,e-1,i),m=o[s+1+n[r+1+n[a+1]]].dot3(t-1,e-1,i-1),x=d(t),v=d(e),b=d(i);return c(c(c(l,g,x),c(h,y,x),b),c(c(u,p,x),c(f,m,x),b),v)}}(this)},"./src/node/Node.js":(t,e,i)=>{"use strict";const s=i("./src/geometry/vec.js");t.exports=class t{static id=0;static getUniqueId(){return++t.id}position=new s(0,0);angle=0;children=new Set;added=!1;constructor(){this.id=t.getUniqueId()}setPosition(t){let e=t.sub(this.position);this.translate(e)}translate(t){this.position.add2(t);for(let t of this.children)t.translate(delta)}setAngle(t){if(!isNaN(t)&&t!==this.angle){let e=Common.angleDiff(t,this.angle);this.translateAngle(e)}}translateAngle(t){if(!isNaN(t)){this.angle+=t;for(let e of this.children)e.translateAngle?.(t)}}add(){if(!this.added){this.trigger("add"),this.added=!0;for(let t of this.children)t.add()}}delete(){if(this.added){this.trigger("delete"),this.added=!1;for(let t of this.children)t.delete()}}addChild(...t){for(let e of t)this.children.add(e)}removeChild(...t){for(let e of t)this.children.delete(e)}#t={delete:[],add:[]};on(t,e){this.#t[t]?this.#t[t].push(e):console.warn(t+" is not a valid event")}off(t,e){(t=this.#t[t]).includes(e)&&t.splice(t.indexOf(e),1)}trigger(t){this.#t[t]&&this.#t[t].forEach((t=>{t()}))}}},"./src/node/World.js":(t,e,i)=>{const s=i("./src/node/Node.js"),r=i("./src/core/Common.js"),n=i("./src/geometry/Grid.js"),o=i("./src/geometry/vec.js"),a=i("./src/physics/RigidBody.js");t.exports=class t extends s{static defaultOptions={gravity:new o(0,500),gridSize:500};gravity=new o(0,0);timescale=1;time=0;bodies=new Set;constraints=new Set;pairs={};dynamicGrid;staticGrid;globalPoints=[];globalVectors=[];constructor(e={}){super();let i={...t.defaultOptions};r.merge(i,e,1),e=i;let{gravity:s,gridSize:a}=e;this.gravity=new o(s),this.dynamicGrid=new n(a),this.staticGrid=new n(a)}canCollide(t,e){let{layer:i,mask:s}=t,{layer:r,mask:n}=e;return 0!=(s&r)||0!=(n&i)}#e(t){let e=[],i=this.canCollide;for(let s=0;s<t.length-1;s++){let r=t[s];if(r.added){if(r.hasCollisions)for(let n=s+1;n<t.length;n++){let s=t[n];if(!s.added){s.isStatic?this.staticGrid.removeBody(s):this.dynamicGrid.removeBody(s);continue}if(!s.hasCollisions||r.parent&&r.parent===s.parent)continue;if(!i(r.collisionFilter,s.collisionFilter))continue;const o=r.bounds,a=s.bounds;o.min.x<=a.max.x&&o.max.x>=a.min.x&&o.min.y<=a.max.y&&o.max.y>=a.min.y&&e.push([r,s])}}else r.isStatic?this.staticGrid.removeBody(r):this.dynamicGrid.removeBody(r)}return e}get collisionPairs(){let t=this.canCollide,e=this.dynamicGrid,i=this.staticGrid,s=r.pairCommon,n=new Set,o=[],a=e.grid,l=i.grid,h=e.gridIds;for(let e of h){let i=a[e],r=l[e],h=this.#e(i);if(r)for(let e=0;e<i.length;e++){let s=i[e];if(s.hasCollisions)for(let e=0;e<r.length;e++){let i=r[e];if(!i.hasCollisions||s.isStatic&&i.isStatic||s.parent&&s.parent===i.parent)continue;if(!t(s.collisionFilter,i.collisionFilter))continue;const n=s.bounds,o=i.bounds;n.min.x<=o.max.x&&n.max.x>=o.min.x&&n.min.y<=o.max.y&&n.max.y>=o.min.y&&h.push([s,i])}}for(let t=0;t<h.length;t++){let e=h[t],i=s(e[0].id,e[1].id);n.has(i)||(n.add(i),o.push(e))}}return o}addChild(...t){super.addChild(...t);for(let e of t)e instanceof a&&this.bodies.add(e),e.isStatic?this.staticGrid.addBody(e):this.dynamicGrid.addBody(e)}removeChild(...t){super.removeChild(...t);for(let e of t)e instanceof a&&this.bodies.delete(e),e._Grids&&(e._Grids[this.staticGrid.id]&&this.staticGrid.removeBody(e),e._Grids[this.dynamicGrid.id]&&this.dynamicGrid.removeBody(e))}}},"./src/physics/Engine.js":(t,e,i)=>{const s=i("./src/geometry/vec.js"),r=i("./src/core/Common.js"),n=i("./src/core/Performance.js"),o=i("./src/physics/RigidBody.js");t.exports=class t{static defaultOptions={delta:1,substeps:5,velocityIterations:1,positionIterations:5,constraintIterations:1,maxShare:1};delta=1;substeps=5;velocityIterations=1;positionIterations=5;constraintIterations=1;maxShare=1;constructor(e,i={}){let s={...t.defaultOptions};r.merge(s,i,1),i=s;let o=["substeps","velocityIterations","positionIterations","constraintIterations","maxShare"];for(let t of o)null!=i[t]&&"function"!=typeof this[t]&&(this[t]=i[t]);this.World=e,this.Performance=new n}update=function(t){const{World:e,Performance:i,substeps:s}=this,{bodies:r}=e;void 0===t&&(t=i.delta*e.timescale),e.time+=t,t/=s,this.delta=t,i.update();for(let n=0;n<s;n++){i.frame++;for(let e of r)e._update(t);e.globalVectors=[],e.globalPoints=[];const s=e.collisionPairs;for(let t=0;t<s.length;t++){let e=s[t][0],i=s[t][1];this.collides(e,i)&&this.createPair(e,i)}for(let e of r)e._preUpdate(t);for(let e=0;e<this.velocityIterations;e++)this.solveVelocity(t);for(let t=0;t<this.positionIterations;t++)this.solvePositions();this.solveConstraints(t)}this.delta=t*s};collides(t,e){if(t.isStatic&&e.isStatic)return!1;let i=!0;function s(t,e){let i=t.vertices,s=-1/0,r=1/0;for(let t=0;t<i.length;t++){let n=e.dot(i[t]);n>s&&(s=n),n<r&&(r=n)}return{max:s,min:r}}if(t._lastSeparations[e.id]){let r=t._lastSeparations[e.id],n=s(t,r),o=s(e,r);Math.min(n.max-o.min,o.max-n.min)<0?i=!1:(delete t._lastSeparations[e.id],delete e._lastSeparations[t.id])}if(i){for(let r=0;r<t._axes.length;r++){let n=t._axes[r],o=s(t,n),a=s(e,n);if(Math.min(o.max-a.min,a.max-o.min)<0){i=!1,t._lastSeparations[e.id]=n,e._lastSeparations[t.id]=n;break}}for(let r=0;r<e._axes.length;r++){let n=e._axes[r],o=s(e,n),a=s(t,n);if(Math.min(o.max-a.min,a.max-o.min)<0){i=!1,t._lastSeparations[e.id]=n,e._lastSeparations[t.id]=n;break}}}return i}createPair(t,e){const{World:i,Performance:n}=this;let o,a,l,h,d=1/0,c=[],u=0;function f(t,e){let i=t.vertices;for(let s=0;s<i.length;s++){let r=i[s],n=i[(s+1)%i.length],f=r.sub(n).normal().normalize(),g=e._getSupport(f,r);e.containsPoint(r)&&(c.push({vertice:r,body:t}),u++),g[1]<d&&(d=g[1],o=f.mult(-1),a=r.avg(n),h=e,l=t)}}f(t,e),f(e,t),0===c.length&&c.push({vertice:new s(t.position),body:t}),o.mult2(-1),i.globalVectors.push({position:a,vector:new s(o)}),i.globalPoints.push(...c.map((t=>t.vertice)));let g=r.pairCommon(t.id,e.id),y={bodyA:l,bodyB:h,depth:d,penetration:o.mult(d),contacts:c,totalContacts:u,normal:o,tangent:o.normal(),id:g,frame:n.frame,start:i.time};i.pairs[g]?(y.start=i.pairs[g].start,t.trigger("collisionActive",y),e.trigger("collisionActive",y),t.trigger("bodyInside",e),e.trigger("bodyInside",t)):(t.trigger("collisionStart",y),e.trigger("collisionStart",y),t.trigger("bodyEnter",e),e.trigger("bodyEnter",t),t.pairs.push(g),e.pairs.push(g)),i.pairs[g]=y}cleansePair(t){const{Performance:e,World:i}=this;if(t.frame<e.frame){let{bodyA:e,bodyB:s}=t;return e.pairs.splice(e.pairs.indexOf(t.id),1),s.pairs.splice(s.pairs.indexOf(t.id),1),delete i.pairs[t.id],e.trigger("collisionEnd",t),s.trigger("collisionEnd",t),e.trigger("bodyExit",s),s.trigger("bodyExit",e),!0}return!1}solveVelocity=function(){let{pairs:t}=this.World;for(let i in t){let r=t[i];if(!r||this.cleansePair(r))continue;let{bodyA:n,bodyB:a,normal:l,tangent:h,contacts:d}=r,c=d.length;if(0===c)continue;for(;n.parent instanceof o&&n.parent!==n;)n=n.parent;for(;a.parent instanceof o&&a.parent!==a;)a=a.parent;if(n.isSensor||a.isSensor)continue;const u=1+Math.max(n.restitution,a.restitution),f=a.velocity.sub(n.velocity),g=Math.max(n.friction,a.friction),y=Math.max(n._slop,a._slop);if(f.dot(l)<0)continue;let p=new s(0,0),m=0,x=0,v=n.mass+a.mass,b=a.mass/v||0,w=n.mass/v||0,S=this.maxShare;b=Math.min(S,b),w=Math.min(S,w),n.isStatic&&(w=1),a.isStatic&&(b=1);for(let t=0;t<c;t++){const{vertice:i}=d[t],s=i.sub(n.position),r=i.sub(a.position),o=n.velocity.add(s.normal().mult(-n.angularVelocity)),c=a.velocity.add(r.normal().mult(-a.angularVelocity));var e=o.sub(c);const f=e.abs().sub(y).mult(e.sign()).dot(l),v=e.dot(h);if(f>0)continue;1==t&&console.log(c);let b=s.cross(l),w=r.cross(l),S=1/(d.length*(n._inverseMass+a._inverseMass+n._inverseInertia*b*b+a._inverseInertia*w*w));const M=u*f*S,C=u*v*S,j=l.mult(M).add2(h.mult(C*g));p.add2(j),m+=s.cross(j)*n._inverseInertia,x+=r.cross(j)*a._inverseInertia}n.isStatic||(n.velocity.sub2(p.mult(1/n.mass)),n.angularVelocity-=m/n.mass),a.isStatic||(a.velocity.add2(p.mult(1/a.mass)),a.angularVelocity+=x/a.mass)}};solvePositions=function(){const{World:t}=this;let{pairs:e}=t;for(let t in e){let i=e[t];if(!i||this.cleansePair(i))continue;let{depth:s,bodyA:r,bodyB:n,normal:o}=i;for(;r.parent&&r.parent!==r;)r=r.parent;for(;n.parent&&n.parent!==n;)n=n.parent;if(r.isSensor||n.isSensor)continue;if(s<1)continue;let a=o.mult(s-1),l=r.mass+n.mass,h=n.mass/l||0,d=r.mass/l||0,c=this.maxShare;if(h=Math.min(c,h),d=Math.min(c,d),r.isStatic&&(d=1),n.isStatic&&(h=1),(r.isStatic||n.isStatic)&&a.mult(0),!r.isStatic){let t=a.mult(.95*h/r.pairs.length);r.translate(t)}if(!n.isStatic){let t=a.mult(.95*-d/n.pairs.length);n.translate(t)}i.depth-=a.length}};solveConstraints=function(t){t*=1e3;const e=this.World.constraints,i=this.constraintIterations;t/=i;for(let s=0;s<i;s++)for(let r=0;r<e.length;r++){let n=e[r],{bodyA:o,bodyB:a,offsetA:l,offsetB:h,stiffness:d,angularStiffness:c,length:u,ignoreSlack:f}=n,g=o.position.add(l.rotate(o.angle)),y=a.position.add(h.rotate(a.angle)),p=g.sub(y),m=p.normalize(),x=m.normal(),v=o.mass+a.mass,b=a.mass/v||0,w=o.mass/v||0,S=this.maxShare;function M(t,e,i){let s=e.sub(i.position),r=s.length;r>3*u&&s.mult2(u/r);const n=i.velocity.add(s.normal().mult(-i.angularVelocity)),o=t.sub(e).mult(30*d);f&&p.length<u*(1+d)&&(n.mult2(0),o.mult2(0));const a=n.sub(o),l=a.dot(m);let h=a.dot(x),g=d*l;g=Math.min(Math.abs(g),300)*Math.sign(g);let y=m.mult(g).add2(x.mult(h*c));return{angularImpulse:s.cross(y)*i._inverseInertia/2,normalImpulse:y.mult(.5)}}b=Math.min(S,b),w=Math.min(S,w),o.isStatic&&(w=1),a.isStatic&&(b=1);let C=g.sub(y).normalize().mult(u),j=o.isStatic?g:y.add(C),I=a.isStatic?y:g.sub(C),{angularImpulse:P,normalImpulse:R}=M(j,g,o),{angularImpulse:k,normalImpulse:A}=M(I,y,a);o.isStatic||(o.velocity.sub2(R.mult(b*t)),o.angularVelocity-=P*b*t),a.isStatic||(a.velocity.sub2(A.mult(w*t)),a.angularVelocity-=k*w*t),n.updateBounds()}}}},"./src/physics/RigidBody.js":(t,e,i)=>{const s=i("./src/geometry/vec.js"),r=i("./src/node/Node.js"),n=i("./src/core/Common.js"),o=i("./src/lib/poly-decomp.js"),a=i("./src/render/PolygonRender.js"),l=i("./src/render/Sprite.js"),h=i("./src/geometry/Bezier.js"),d=i("./src/geometry/Bounds.js");t.exports=class t extends r{static defaultOptions={mass:1,restitution:.5,frictionAir:.05,frictionAngular:.01,friction:.01,round:0,isStatic:!1,isSensor:!1,hasCollisions:!0,collisionFilter:{layer:16777215,mask:16777215}};static roundVertices(t,e,i=40){let s=[],r=t.length;for(let n=0;n<r;n++){let o=t[(n-1+r)%r],a=t[n],l=t[(n+1)%r],d=a.sub(o),c=l.sub(a),u=d.normalize(),f=c.normalize(),g=Math.min(e,d.length/2),y=Math.min(e,c.length/2),p=Math.min(g,y),m=u.mult(-p).add(a),x=u.mult(.45*-p).add(a),v=f.mult(.45*p).add(a),b=f.mult(p).add(a),w=new h(m,x,v,b);for(let t=0;t<w.length;)s.push(w.get(t)),t+=i;s.push(b)}return s}vertices=[];mass=1;restitution=.5;frictionAir=.05;frictionAngular=.01;friction=.01;round=0;isStatic=!1;isSensor=!1;hasCollisions=!0;collisionFilter={layer:16777215,mask:16777215};constructor(e,i,r,o={}){super(),this.Engine||(this.Engine=e),this.World=this.Engine.World,delete o.World,o.render&&(this.addChild(o.render),delete o.render),"object"==typeof o.collisionFilter&&n.merge(this.collisionFilter,o.collisionFilter,1),n.merge(this,o,1);for(let t in["layer","mask"])"string"==typeof this.collisionFilter[t]&&(this.collisionFilter[t]=parseInt(this.collisionFilter[t],2));this.vertices=i.map((t=>new s(t))),o.round&&o.round>0&&(this.vertices=t.roundVertices(this.vertices,this.round,this.roundQuality)),this.bounds=new d(this.vertices),this.#i(),this._resetVertices(!1),this._resetVertices(),this._updateInertia(),o.angle&&(this.angle=0,this.setAngle(-o.angle)),this.setPosition(r)}add(){let t=this.Engine.World;return this.added||(super.add(),t.addChild(this)),this}delete(){let t=this.Engine.World;if(this.added){super.delete(),t.removeChild(this);for(let t=0;t<this.pairs.length;t++)this.Engine.cleansePair(this.pairs[t])}return this}addPolygonRender(t,e){let i=new a({container:t,position:new s(this.position),vertices:this.vertices,...e});return this.added&&i.add(),this.addChild(i),this}addSprite(t,e){let i=new l({container:t,position:new s(this.position),...e});return this.added&&i.add(),this.addChild(i),this}setStatic(t){let{dynamicGrid:e,staticGrid:i}=this.Engine.World,s=this.isStatic;t!==s&&(this.isStatic=t,this.hasCollisions&&!this.removed&&(s?i.removeBody(this):e.removeBody(this),t?i.addBody(this):e.addBody(this)))}setCollisions(t){let{dynamicGrid:e,staticGrid:i}=this.Engine.World;t!==this.hasCollisions&&(this.hasCollisions=t,this.hasCollisions?this.isStatic?i.addBody(this):e.addBody(this):this.isStatic?i.removeBody(this):e.removeBody(this))}containsPoint(t){let e=this.vertices;for(let i=0;i<e.length;i++){let s=e[i],r=e[(i+1)%e.length];if((t.x-s.x)*(r.y-s.y)+(t.y-s.y)*(s.x-r.x)>=0)return!1}return!0}setPosition(t,e=!1){let i=t.sub(this.position);this.translate(i,!0,e)}translate(t,e=!0,i=!1){if(t.isNaN())return;let s=this.vertices;for(let e=0;e<s.length;e++)s[e].add2(t);e&&this.position.add2(t),this.bounds.update(this.vertices);let r=this.Engine.World.dynamicGrid;if(this._Grids&&this._Grids[r.id]&&r.updateBody(this),!i){let i=this.children;for(let s of i)s.translate(t,e)}}setAngle(t){if(!isNaN(t)&&t!==this.angle){let e=n.angleDiff(t,this.angle);this.translateAngle(e)}}translateAngle(t,e=!1){if(isNaN(t))return;let i=this.vertices,s=this.position,r=this.rotationPoint.rotate(this.angle+t);this.parent&&r.add2(this.position.sub(this.parent.position));let n=Math.sin(t),o=Math.cos(t);for(let t=i.length;t-- >0;){let e=i[t],r=e.sub(s);e.x=s.x+(r.x*o-r.y*n),e.y=s.y+(r.x*n+r.y*o)}let a=r.sub(r.rotate(t));this.translate(a),e||(this.angle+=t),this.bounds.update(this.vertices),this.#s();for(let i of this.children)i.translateAngle?.(t,e)}setVelocity(t){if(t.isNaN())throw console.error(t),new Error("Invalid velocity");this.isStatic||this.velocity.set(t)}setAngularVelocity(t){if(t.isNaN())throw console.error(t),new Error("Invalid angular velocity");this.isStatic||(this.angularVelocity=t)}applyForce(t,e=Engine.delta){t.isNaN()||this.isStatic||this.force.add2(t.mult(e))}applyTorque(t,e=Engine.delta){isNaN(t)||(this.torque+=t*e)}Engine=null;parent=null;position=new s(0,0);velocity=new s(0,0);angle=0;angularVelocity=0;_last={velocity:new s(0,0),angularVelocity:0};force=new s(0,0);impulse=new s(0,0);center=new s(0,0);torque=0;axes=[];rotationPoint=new s(0,0);_inverseMass=1;inertia=1;_inverseInertia=15e-6;pairs=[];_lastSeparations={};_slop=.001;bounds=null;#t={collisionStart:[],collisionActive:[],collisionEnd:[],bodyEnter:[],bodyInside:[],bodyExit:[],beforeUpdate:[],duringUpdate:[],delete:[],add:[]};_preUpdate(t){this.trigger("beforeUpdate"),this.isStatic||(this.velocity.add2(this.force).add2(this.Engine.World.gravity.mult(t)),this.angularVelocity+=this.torque,this.force.x=0,this.force.y=0,this.torque=0)}_update(t){if(this.trigger("duringUpdate"),this.isStatic)return;const e=t;let{velocity:i,angularVelocity:s}=this._last,r=(1-this.frictionAir)**e,n=(1-this.frictionAngular)**e;isNaN(e)||this.velocity.isNaN()||isNaN(r+n)||(this.velocity.mult2(r),0===this.velocity.x&&0===this.velocity.y||this.translate(this.velocity.add(i).mult(e/2)),this._last.velocity.set(this.velocity),this.angularVelocity*=n,this.angularVelocity&&this.translateAngle((this.angularVelocity+s)*e/2),this._last.angularVelocity=this.angularVelocity,this.bounds.update(this.vertices),this.hasCollisions&&this.Engine.World.dynamicGrid.updateBody(this))}#r(){let t=0,e=this.vertices,i=e.length;for(let s=0;s<i;s++)t+=e[s].cross(e[(s+1)%i]);return.5*t}#n(){const{vertices:t,mass:e}=this;let i=0,s=0;for(var r=0;r<t.length;r++){let e=(r+1)%t.length,n=Math.abs(t[e].cross(t[r]));i+=n*(t[e].dot(t[e])+t[e].dot(t[r])+t[r].dot(t[r])),s+=n}return e/6*(i/s)}_updateInertia(){this.isStatic?(this.mass=1/0,this._inverseMass=0):(this.inertia=this.#n(),this._inverseInertia=1/this.inertia)}#i(t=1){let e=this.vertices;for(let i=0;i<e.length;i++){let s=e[i];for(let r=0;r<e.length;r++){if(r===i)continue;let n=e[r],o=s.sub(n);if(Math.abs(o.x)+Math.abs(o.y)<t){e.splice(i,1),i--;break}}}}#o(){let t=this.vertices,e=t.length,i=t[0].sub(t[1]),s=0;for(let r=1;r<e;r++){let n=t[r].sub(t[(r+1)%e]),o=Math.sign(n.cross(i));if(0===s)s=o;else if(0!==o&&s!==o)return!1;i=n}return!0}#a(){if(!this.#o()){let t=this.added;this.delete();let{vertices:e,position:i}=this;this.children=[];let r=e.map((t=>[t.x,t.y]));o.removeCollinearPoints(r,.4);let a=o.quickDecomp(r),l=this.#l();for(let t=0;t<a.length;t++){let e=a[t].map((t=>new s(t[0],t[1]))),r=n.getCenterOfMass(e),o=new FromVertices(e,i.add(r).sub(l));o.delete(),o.parent=this,this.addChild(o)}t&&this.add()}}#l(){let t=n.getCenterOfMass(this.vertices);return this.center.set(t),t}#s(){let t=this.vertices,e=[];for(let i=0;i<t.length;i++){let s=t[i],r=t[(i+1)%t.length];e.push(r.sub(s))}for(let t=0;t<e.length;t++)e[t]=e[t].normal().normalize2();this._axes=e}#h(){let t=this.#l(),e=this.position;t.sub2(e);for(let e=0;e<this.vertices.length;e++)this.vertices[e].sub2(t)}_resetVertices(t=!1){this.#d(t),this.area=this.#r(),this.#h(),this.bounds.update(this.vertices),this.#s()}#d(t=!1){if(t){let t=this.vertices,e=this.position,i=t.map((t=>[t,t.sub(e).angle]));i.sort(((t,e)=>n.angleDiff(t[1],e[1]))),this.vertices=i.map((t=>t[0]))}else{let t=this.vertices,e=this.position,i=t.map((t=>t.sub(e).angle));n.angleDiff(i[0],i[1])>0&&this.vertices.reverse()}}_getSupport(t,e=this.position){let i,s=this.vertices,r=0;for(let n=0;n<s.length;n++){let o=t.dot(s[n].sub(e));o>r&&(r=o,i=n)}return[i,r]}}},"./src/render/Camera.js":(t,e,i)=>{const s=i("./src/geometry/vec.js");t.exports=class{position=new s(0,0);fov=2e3;translation=new s(0,0);scale=1;boundSize=1e3;constructor(t=2e3,e=1e3){this.fov=t,this.boundSize=e}}},"./src/render/DebugRender.js":t=>{t.exports=class{canvas=null;ctx=null;enabled={collisions:!1,boundingBox:!1,vertices:!1,centers:!1,broadphase:!1};constructor(t){this.Game=t;let e=devicePixelRatio??1,i=this.canvas=document.createElement("canvas");this.ctx=i.getContext("2d"),i.style.position="absolute",i.style.zIndex=1,i.style.top="0px",i.style.left="0px",i.width=e*window.innerWidth,i.height=e*window.innerHeight,i.style.background="transparent",i.style.pointerEvents="none",i.style.transformOrigin="top left",i.style.transform=`scale(${1/e}, ${1/e})`,document.body.appendChild(i),t.Render.app.renderer.on("resize",((t,e)=>{let s=devicePixelRatio??1;i.width=t*s,i.height=e*s,i.style.transform=`scale(${1/s}, ${1/s})`})),this.update=this.update.bind(this),t.Render.app.ticker.add(this.update)}update(){let{ctx:t,canvas:e,enabled:i,Game:s}=this;const{Render:r}=s,{camera:n,pixelRatio:o}=r;let a=e.width,l=e.height;const{position:h}=n,d=n.scale*o;let c=new vec({x:-h.x*d+a/2,y:-h.y*d+l/2});t.clearRect(0,0,a,l),t.save(),t.translate(c.x,c.y),t.scale(d,d);for(let t in i)i[t]&&"function"==typeof this[t]&&this[t]();t.restore()}vertices(){const{Game:t,ctx:e}=this,{camera:i,pixelRatio:s}=t.Render,r=i.scale*s;function n(t){e.moveTo(t[0].x,t[0].y);for(let i=0;i<t.length;i++)if(i>0){let s=t[i];e.lineTo(s.x,s.y)}e.closePath()}e.beginPath();let o=t.World.bodies;for(let t of o)n(t.vertices);e.lineWidth=2/r,e.strokeStyle="#FF832A",e.stroke()}collisions(){const{ctx:t,Game:e}=this,{globalPoints:i,globalVectors:s}=e.World;if(i.length>0){t.beginPath();for(let e=0;e<i.length;e++){let s=i[e];t.moveTo(s.x,s.y),t.arc(s.x,s.y,2/camera.scale,0,2*Math.PI),t.fillStyle="#e8e8e8"}t.fill()}if(s.length>0){t.beginPath();for(let e=0;e<s.length;e++){let i=s[e].position,r=s[e].vector;t.moveTo(i.x,i.y),t.lineTo(i.x+10*r.x/camera.scale,i.y+10*r.y/camera.scale),t.strokeStyle="#FFAB2E",t.lineWidth=3/camera.scale}t.stroke()}}centers(){const{ctx:t,Game:e}=this,{camera:i}=e.Render;t.fillStyle="#FF832A";let s=e.World.bodies;t.beginPath();for(let e of s)e.children.size,t.moveTo(e.position.x,e.position.y),t.arc(e.position.x,e.position.y,2/i.scale,0,2*Math.PI);t.fill()}boundingBox(){const{ctx:t,Game:e}=this,{World:i,Render:s}=e,{camera:r}=s;let n=i.bodies,o=i.constraints;t.strokeStyle="#66666680",t.lineWidth=1/r.scale;for(let e of n)if(!e.children||0===e.children.size){let i=e.bounds,s=i.max.x-i.min.x,r=i.max.y-i.min.y;t.beginPath(),t.strokeRect(i.min.x,i.min.y,s,r)}t.strokeStyle="#66666630";for(let e of o){let i=e.bounds,s=i.max.x-i.min.x,r=i.max.y-i.min.y;t.beginPath(),t.strokeRect(i.min.x,i.min.y,s,r)}}broadphase(t=this.Game.World.dynamicGrid){const{ctx:e,Game:i}=this,{camera:s}=i.Render;let r=t.gridSize;e.lineWidth=.4/s.scale,e.strokeStyle="#D0A356",e.fillStyle="#947849",Object.keys(t.grid).forEach((i=>{let s=t.grid[i],n=t.unpair(i).mult(r);e.strokeRect(n.x,n.y,r,r),e.globalAlpha=.003*s.length,e.fillRect(n.x,n.y,r,r),e.globalAlpha=1}))}}},"./src/render/PerformanceRender.js":(t,e,i)=>{const s=i("./src/render/RenderMethods.js");t.exports=class{enabled=!1;canvas=null;ctx=null;position=new vec(20,20);constructor(t,e){this.Performance=t;const i=this.width=100,s=this.height=50;let r=this.scale=devicePixelRatio??1,n=this.canvas=document.createElement("canvas");this.ctx=n.getContext("2d"),n.style.position="absolute",n.style.zIndex=2,n.style.top="20px",n.style.right="0px",n.style.left="unset",n.width=r*i,n.height=r*s,n.style.background="transparent",n.style.pointerEvents="none",n.style.transformOrigin="top left",n.style.transform=`scale(${1/r}, ${1/r})`,document.body.appendChild(n),this.update=this.update.bind(this),e.app.ticker.add(this.update)}update(){let{canvas:t,ctx:e,enabled:i,Performance:r,scale:n,width:o,height:a}=this,{history:l}=r;if(e.clearRect(0,0,t.width,t.height),i){e.save(),e.scale(n,n),e.beginPath(),s.roundedRect(o,a,new vec(o/2,a/2),5,e),e.fillStyle="#0D0D0De6",e.fill();let h=0,d=1/0,c=(()=>{let t=0;for(let e=0;e<l.fps.length;e++){let i=l.fps[e];t+=i,h=Math.max(h,i),d=Math.min(d,i)}return t/l.fps.length})(),u=(()=>{let t=0,e=Math.min(l.fps.length,20);for(let i=0;i<e;i++)t+=l.fps[i];return t/e})();if(e.beginPath(),e.fillStyle="white",e.textAlign="right",e.font="400 12px Arial",e.fillText(`${Math.round(u)} fps`,o-12,17),l.fps.length>10){let y=100,p={min:Math.max(0,Math.min(d,c-y)),max:Math.max(h,c+y,60)};const m=p.max-p.min;let x={min:new vec(10,18),max:new vec(o-10,a-4)};function v(t,e){return[x.max.x-e/l.fps.length*(x.max.x-x.min.x),x.max.y-(t-p.min)/m*(x.max.y-x.min.y)]}e.beginPath(),e.moveTo(...v(l.fps[0],0));for(let b=1;b<l.fps.length;b++)e.lineTo(...v(l.fps[b],b));e.lineWidth=1,e.lineJoin="bevel",e.strokeStyle="#9C9C9C",e.stroke()}e.beginPath();let f=[[.75,"#3FF151"],[.5,"#F5ED32"],[.25,"#F89A2C"],[0,"#F74D4D"]],g=60;e.fillStyle="#808080";for(let w of f)if(c>=w[0]*g){e.fillStyle=w[1];break}s.roundedRect(6,6,new vec(15,13),2,e),e.fill(),e.restore()}}}},"./src/render/PolygonRender.js":(t,e,i)=>{const s=i("./src/node/Node.js"),r=i("./src/geometry/vec.js"),n=i("./src/core/Common.js");t.exports=class t extends s{static defaultOptions={container:null,layer:0,position:new r(0,0),angle:0,type:"polygon",vertices:[],visible:!0,alpha:1,background:"transparent",border:"transparent",borderWidth:3,borderOffset:.5,lineCap:"butt",lineJoin:"miter",width:100,heigth:100,round:0,radius:50};static all=new Set;constructor(e={}){super();let i={...t.defaultOptions};n.merge(i,e,1),e=i,n.merge(this,e,1),this.create()}create(){let t=this.graphic=new PIXI.Graphics,{position:e,angle:i,type:s,vertices:o}=this,{layer:a,alpha:l,background:h,border:d,borderWidth:c,lineCap:u,lineJoin:f,borderOffset:g,round:y}=this,{parseColor:p}=n;if(h=p(h),h[1]>0&&t.beginFill(...h),d=p(d),d[1]>0&&t.lineStyle({width:c,color:d[0],alpha:d[1],cap:u,join:f,alignment:g}),"rectangle"===s){let{width:e,height:i}=this;y>0?t.drawRoundedRect(-e/2,-i/2,e,i,y):t.drawRect(-e/2,-i/2,e,i)}else if("circle"===s){let{radius:e}=this;t.drawCircle(0,0,e)}else{let e=n.getCenterOfMass(o);t.drawPolygon(o.map((t=>t.sub(e))))}d[1]>0&&t.closePath(),h[1]>0&&t.endFill(),t.zIndex=a;let m=new r(e);this.position=new r(0,0),this.translate(m),this.angle=0,this.translateAngle(i),this.setAlpha(l),this.trigger("load")}setLayer(t){this.layer=t,this.graphic.zIndex=t}setAlpha(t){this.alpha=t,this.graphic.alpha=t}setVisible(t){this.visible=t,this.graphic.visible=t}translate(t){super.translate(t);let{graphic:e}=this;e.position.x+=t.x,e.position.y+=t.y}translateAngle(t){let{graphic:e}=this;this.angle+=t,e.rotation+=t}add(){super.add(),t.all.add(this),this.container.addChild(this.graphic)}delete(){super.delete(),t.all.delete(this),this.container.removeChild(this.graphic)}destroy(){this.graphic.destroy()}#t={delete:[],add:[],load:[]}}},"./src/render/Render.js":(t,e,i)=>{const s=i("./src/render/Camera.js"),r=i("./src/core/Common.js"),n=i("./src/geometry/vec.js");t.exports=class t{static defaultOptions={background:!1,pixelRatio:window.devicePixelRatio??1,ySort:!1,resizeTo:window,antialias:!0,getBoundSize:function(t,e){return Math.sqrt(t**2+e**2)||1}};app=null;camera=null;pixelRatio=1;nodes=new Set;constructor(e={}){try{PIXI.settings}catch(t){throw new Error("PIXI is not defined\nHelp: try loading pixi.js before creating a ter app")}let i={...t.defaultOptions},n=e.resizeTo??i.resizeTo;delete e.resizeTo,r.merge(i,e,1),e=i;let{background:o,ySort:a,pixelRatio:l,antialias:h,getBoundSize:d}=e;this.camera=new s,this.getBoundSize=d;let c=PIXI.settings.RESOLUTION=PIXI.settings.FILTER_RESOLUTION=this.pixelRatio=l;PIXI.Container.defaultSortableChildren=!0;let u=this.app=new PIXI.Application({background:o??0,backgroundAlpha:o&&"transparent"!=o?1:0,resizeTo:n??window,antialias:h??!0});document.body.appendChild(u.view),u.ticker.add(this.update.bind(this)),u.stage.filters=[],u.stage.sortableChildren=!0;let f=u.view;f.style.transformOrigin="top left",f.style.transform=`scale(${1/c}, ${1/c})`,this.setSize(u.screen.width,u.screen.height),u.renderer.on("resize",this.setSize.bind(this)),a&&u.stage.on("sort",(function(t){t.zOrder=t.y}))}setSize(t,e){let i=this.pixelRatio;this.camera.boundSize=this.getBoundSize(t,e)*i}setPixelRatio(t){this.pixelRatio=t,this.setSize(this.app.screen.width,this.app.screen.height)}addChild(...t){for(let e of t)this.nodes.add(e)}removeChild(...t){for(let e of t)this.nodes.delete(e)}update(){this.trigger("beforeUpdate");let{app:t,camera:e}=this,{stage:i}=t,{position:s,translation:r,fov:o,boundSize:a}=e,l=new n(t.screen.width,t.screen.height);r.set({x:-s.x*a/o+l.x/2,y:-s.y*a/o+l.y/2}),e.scale=a/o;for(let t of this.nodes)t.render.graphic&&(t.render.graphic.update(),t.trigger("render"));i.x=r.x,i.y=r.y,i.scale.x=e.scale,i.scale.y=e.scale,this.trigger("afterUpdate")}#t={beforeUpdate:[],afterUpdate:[]};on(t,e){this.#t[t]?this.#t[t].push(e):console.warn(t+" is not a valid event")}off(t,e){(t=this.#t[t]).includes(e)&&t.splice(t.indexOf(e),1)}trigger(t){this.#t[t]&&this.#t[t].forEach((t=>{t()}))}}},"./src/render/RenderMethods.js":t=>{let e=t.exports={screenPtToGame:function(t,e){const{camera:i,pixelRatio:s}=e,{scale:r,translation:n}=i;return new vec((t.x*s-n.x)/r,(t.y*s-n.y)/r)},gamePtToScreen:function(t,e){const{camera:i,pixelRatio:s}=e,{scale:r,translation:n}=i;return new vec((t.x*r+n.x)/s,(t.y*r+n.y)/s)},roundedPolygon:function(t,e,i){if(t.length<3)return void console.warn("RenderMethods.roundedPolygon needs at least 3 vertices",t);function s(i){let s=t[i],r=t[(t.length+i-1)%t.length],n=t[(i+1)%t.length],o=r.sub(s),a=s.sub(n),l=o.length,h=a.length,d=Math.min(l/2,h/2,e),c=s,u=c.add(o.normalize().mult(d)),f=c.sub(a.normalize().mult(d));return[u,c,f]}let r=s(0);i.moveTo(r[0].x,r[0].y),i.quadraticCurveTo(r[1].x,r[1].y,r[2].x,r[2].y);for(let e=1;e<t.length;e++){let t=s(e);i.lineTo(t[0].x,t[0].y),i.quadraticCurveTo(t[1].x,t[1].y,t[2].x,t[2].y)}i.lineTo(r[0].x,r[0].y)},roundedPolygonCtx:function(t,e,i){if(t.length<3)return void console.warn("RenderMethods.roundedPolygon needs at least 3 vertices",t);function s(i){let s=t[i],r=t[(t.length+i-1)%t.length],n=t[(i+1)%t.length],o=r.sub(s),a=s.sub(n),l=o.length,h=a.length,d=Math.min(l/2,h/2,e),c=s,u=c.add(o.normalize().mult(d)),f=c.sub(a.normalize().mult(d));return[u,c,f]}let r=s(0);i.moveTo(r[0].x,r[0].y),i.quadraticCurveTo(r[1].x,r[1].y,r[2].x,r[2].y);for(let e=1;e<t.length;e++){let t=s(e);i.lineTo(t[0].x,t[0].y),i.quadraticCurveTo(t[1].x,t[1].y,t[2].x,t[2].y)}i.closePath()},roundedRect:function(t,i,s,r,n){e.roundedPolygonCtx([new vec(-t/2,-i/2).add2(s),new vec(t/2,-i/2).add2(s),new vec(t/2,i/2).add2(s),new vec(-t/2,i/2).add2(s)],r,n)},arrow:function(t,e,i=10,s){let r=new vec(t.x+e.x,t.y+e.y),n=e.rotate(3*Math.PI/4).normalize2().mult(i),o=n.reflect(e.normalize());s.moveTo(t.x,t.y),s.lineTo(r.x,r.y),s.lineTo(r.x+n.x,r.y+n.y),s.moveTo(r.x,r.y),s.lineTo(r.x+o.x,r.y+o.y)}}},"./src/render/RenderTypes.js":(t,e,i)=>{let s=t.exports;s.Polygon=i("./src/render/PolygonRender.js"),s.Sprite=i("./src/render/Sprite.js")},"./src/render/Sprite.js":(t,e,i)=>{const s=i("./src/core/Common.js"),r=i("./src/node/Node.js"),n=i("./src/geometry/vec.js");t.exports=class t extends r{static imageDir="./img/";static defaultOptions={container:null,layer:0,position:new n(0,0),angle:0,visible:!0,alpha:1,src:"",scale:new n(1,1),width:void 0,heigth:void 0};static all=new Set;loaded=!1;constructor(e){super();let i={...t.defaultOptions};s.merge(i,e,1),e=i,s.merge(this,e,1),this.src=t.imageDir+this.src,this.position=new n(this.position??{x:0,y:0}),this.add=this.add.bind(this),this.create()}create(){let{width:t,height:e,layer:i,position:s,angle:r,src:o}=this,a=this.sprite=PIXI.Sprite.from(o);this.loaded=!0,a.anchor.set(.5),null!=t&&null!=e&&this.setSize(t,e),this.setAlpha(this.alpha),this.setLayer(i);let l=new n(s);this.position.set(new n(0,0)),this.translate(l),this.angle=0,this.translateAngle(r),this.trigger("load")}setLayer(t){this.layer=t,this.loaded&&(this.sprite.zIndex=t)}setScale(t){if(this.scale.set(t),!this.loaded)return;let{sprite:e}=this;e.scale.x=this.scale.x,e.scale.y=this.scale.y}setSize(t,e){if(null!=t&&(this.width=t),null!=e&&(this.height=e),!this.loaded)return;let{sprite:i}=this;i.width=this.width,i.height=this.height}setAlpha(t){this.alpha=t,this.loaded&&(this.sprite.alpha=t)}setVisible(t){this.visible=t,this.loaded&&(this.sprite.visible=t)}translate(t){if(super.translate(t),!this.loaded)return;let{sprite:e}=this;e.position.x+=t.x,e.position.y+=t.y}translateAngle(t){if(super.translateAngle(t),!this.loaded)return;let{sprite:e}=this;e.rotation+=t}add(){this.sprite||!this.added?(super.add(),t.all.add(this),this.container.addChild(this.sprite)):this.on("load",this.add)}delete(){super.delete(),t.all.delete(this),this.container.removeChild(this.sprite),this.off("load",this.add)}destroy(){this.sprite.destroy()}#t={load:[],add:[],delete:[]}}},"./src/ter.js":(t,e,i)=>{let s=t.exports;s.Performance=i("./src/core/Performance.js"),s.Game=i("./src/core/Game.js"),s.Common=i("./src/core/Common.js"),s.Ticker=i("./src/core/Ticker.js"),s.Node=i("./src/node/Node.js"),s.World=i("./src/node/World.js"),s.Engine=i("./src/physics/Engine.js"),s.Bodies=i("./src/bodies/Bodies.js"),s.Render=i("./src/render/RenderTypes.js"),vec=i("./src/geometry/vec.js"),s.Grid=i("./src/geometry/Grid.js"),s.Bezier=i("./src/geometry/Bezier.js"),s.Bounds=i("./src/geometry/Bounds.js"),s.simplexNoise=i("./src/lib/simplexNoise.js"),s.polyDecomp=i("./src/lib/poly-decomp.js"),s.BehaviorTree=i("./src/extra/BehaviorTree.js"),s.Functions=i("./src/extra/GameFunctions.js")}},e={},function i(s){var r=e[s];if(void 0!==r)return r.exports;var n=e[s]={exports:{}};return t[s].call(n.exports,n,n.exports,i),n.exports}("./src/ter.js");var t,e}));
//# sourceMappingURL=ter.js.map
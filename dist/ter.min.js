!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("ter",[],e):"object"==typeof exports?exports.ter=e():t.ter=e()}(self,(()=>{return t={371:t=>{function e(t,e,i){i=i||0;var s,n,r,a,o,l,h,d=[0,0];return s=t[1][1]-t[0][1],n=t[0][0]-t[1][0],r=s*t[0][0]+n*t[0][1],a=e[1][1]-e[0][1],o=e[0][0]-e[1][0],l=a*e[0][0]+o*e[0][1],S(h=s*o-a*n,0,i)||(d[0]=(o*r-n*l)/h,d[1]=(s*l-a*r)/h),d}function i(t,e,i,s){var n=e[0]-t[0],r=e[1]-t[1],a=s[0]-i[0],o=s[1]-i[1];if(a*r-o*n==0)return!1;var l=(n*(i[1]-t[1])+r*(t[0]-i[0]))/(a*r-o*n),h=(a*(t[1]-i[1])+o*(i[0]-t[0]))/(o*n-a*r);return l>=0&&l<=1&&h>=0&&h<=1}function s(t,e,i){return(e[0]-t[0])*(i[1]-t[1])-(i[0]-t[0])*(e[1]-t[1])}function n(t,e,i){return s(t,e,i)>0}function r(t,e,i){return s(t,e,i)>=0}function a(t,e,i){return s(t,e,i)<0}function o(t,e,i){return s(t,e,i)<=0}t.exports={decomp:function(t){var e=w(t);return e.length>0?b(t,e):[t]},quickDecomp:function t(e,i,s,l,h,d,g){d=d||100,g=g||0,h=h||25,i=void 0!==i?i:[],s=s||[],l=l||[];var y=[0,0],m=[0,0],v=[0,0],w=0,b=0,S=0,C=0,I=0,P=0,A=0,k=[],N=[],E=e,T=e;if(T.length<3)return i;if(++g>d)return console.warn("quickDecomp: max level ("+d+") reached."),i;for(var R=0;R<e.length;++R)if(f(E,R)){s.push(E[R]),w=b=Number.MAX_VALUE;for(var _=0;_<e.length;++_)n(u(E,R-1),u(E,R),u(E,_))&&o(u(E,R-1),u(E,R),u(E,_-1))&&(v=M(u(E,R-1),u(E,R),u(E,_),u(E,_-1)),a(u(E,R+1),u(E,R),v)&&(S=c(E[R],v))<b&&(b=S,m=v,P=_)),n(u(E,R+1),u(E,R),u(E,_+1))&&o(u(E,R+1),u(E,R),u(E,_))&&(v=M(u(E,R+1),u(E,R),u(E,_),u(E,_+1)),n(u(E,R-1),u(E,R),v)&&(S=c(E[R],v))<w&&(w=S,y=v,I=_));if(P===(I+1)%e.length)v[0]=(m[0]+y[0])/2,v[1]=(m[1]+y[1])/2,l.push(v),R<I?(p(k,E,R,I+1),k.push(v),N.push(v),0!==P&&p(N,E,P,E.length),p(N,E,0,R+1)):(0!==R&&p(k,E,R,E.length),p(k,E,0,I+1),k.push(v),N.push(v),p(N,E,P,R+1));else{if(P>I&&(I+=e.length),C=Number.MAX_VALUE,I<P)return i;for(_=P;_<=I;++_)r(u(E,R-1),u(E,R),u(E,_))&&o(u(E,R+1),u(E,R),u(E,_))&&(S=c(u(E,R),u(E,_)))<C&&x(E,R,_)&&(C=S,A=_%e.length);R<A?(p(k,E,R,A+1),0!==A&&p(N,E,A,T.length),p(N,E,0,R+1)):(0!==R&&p(k,E,R,T.length),p(k,E,0,A+1),p(N,E,A,R+1))}return k.length<N.length?(t(k,i,s,l,h,d,g),t(N,i,s,l,h,d,g)):(t(N,i,s,l,h,d,g),t(k,i,s,l,h,d,g)),i}return i.push(e),i},isSimple:function(t){var e,s=t;for(e=0;e<s.length-1;e++)for(var n=0;n<e-1;n++)if(i(s[e],s[e+1],s[n],s[n+1]))return!1;for(e=1;e<s.length-2;e++)if(i(s[0],s[s.length-1],s[e],s[e+1]))return!1;return!0},removeCollinearPoints:function(t,e){for(var i=0,s=t.length-1;t.length>3&&s>=0;--s)d(u(t,s-1),u(t,s),u(t,s+1),e)&&(t.splice(s%t.length,1),i++);return i},removeDuplicatePoints:function(t,e){for(var i=t.length-1;i>=1;--i)for(var s=t[i],n=i-1;n>=0;--n)C(s,t[n],e)&&t.splice(i,1)},makeCCW:function(t){for(var e=0,i=t,s=1;s<t.length;++s)(i[s][1]<i[e][1]||i[s][1]===i[e][1]&&i[s][0]>i[e][0])&&(e=s);return!n(u(t,e-1),u(t,e),u(t,e+1))&&(function(t){for(var e=[],i=t.length,s=0;s!==i;s++)e.push(t.pop());for(s=0;s!==i;s++)t[s]=e[s]}(t),!0)}};var l=[],h=[];function d(t,e,i,n){if(n){var r=l,a=h;r[0]=e[0]-t[0],r[1]=e[1]-t[1],a[0]=i[0]-e[0],a[1]=i[1]-e[1];var o=r[0]*a[0]+r[1]*a[1],d=Math.sqrt(r[0]*r[0]+r[1]*r[1]),c=Math.sqrt(a[0]*a[0]+a[1]*a[1]);return Math.acos(o/(d*c))<n}return 0===s(t,e,i)}function c(t,e){var i=e[0]-t[0],s=e[1]-t[1];return i*i+s*s}function u(t,e){var i=t.length;return t[e<0?e%i+i:e%i]}function p(t,e,i,s){for(var n=i;n<s;n++)t.push(e[n])}function f(t,e){return a(u(t,e-1),u(t,e),u(t,e+1))}var g=[],y=[];function m(t,i,s){var n,a,l=g,h=y;if(r(u(t,i+1),u(t,i),u(t,s))&&o(u(t,i-1),u(t,i),u(t,s)))return!1;a=c(u(t,i),u(t,s));for(var d=0;d!==t.length;++d)if((d+1)%t.length!==i&&d!==i&&r(u(t,i),u(t,s),u(t,d+1))&&o(u(t,i),u(t,s),u(t,d))&&(l[0]=u(t,i),l[1]=u(t,s),h[0]=u(t,d),h[1]=u(t,d+1),n=e(l,h),c(u(t,i),n)<a))return!1;return!0}function x(t,e,s){for(var n=0;n!==t.length;++n)if(n!==e&&n!==s&&(n+1)%t.length!==e&&(n+1)%t.length!==s&&i(u(t,e),u(t,s),u(t,n),u(t,n+1)))return!1;return!0}function v(t,e,i,s){var n=s||[];if(function(t){t.length=0}(n),e<i)for(var r=e;r<=i;r++)n.push(t[r]);else{for(r=0;r<=i;r++)n.push(t[r]);for(r=e;r<t.length;r++)n.push(t[r])}return n}function w(t){for(var e=[],i=[],s=[],n=[],r=Number.MAX_VALUE,a=0;a<t.length;++a)if(f(t,a))for(var o=0;o<t.length;++o)if(m(t,a,o)){i=w(v(t,a,o,n)),s=w(v(t,o,a,n));for(var l=0;l<s.length;l++)i.push(s[l]);i.length<r&&(e=i,r=i.length,e.push([u(t,a),u(t,o)]))}return e}function b(t,e){if(0===e.length)return[t];if(e instanceof Array&&e.length&&e[0]instanceof Array&&2===e[0].length&&e[0][0]instanceof Array){for(var i=[t],s=0;s<e.length;s++)for(var n=e[s],r=0;r<i.length;r++){var a=b(i[r],n);if(a){i.splice(r,1),i.push(a[0],a[1]);break}}return i}return n=e,s=t.indexOf(n[0]),r=t.indexOf(n[1]),-1!==s&&-1!==r&&[v(t,s,r),v(t,r,s)]}function M(t,e,i,s,n){n=n||0;var r=e[1]-t[1],a=t[0]-e[0],o=r*t[0]+a*t[1],l=s[1]-i[1],h=i[0]-s[0],d=l*i[0]+h*i[1],c=r*h-l*a;return S(c,0,n)?[0,0]:[(h*o-a*d)/c,(r*d-l*o)/c]}function S(t,e,i){return i=i||0,Math.abs(t-e)<=i}function C(t,e,i){return S(t[0],e[0],i)&&S(t[1],e[1],i)}},789:(t,e,i)=>{const s={Rectangle:i(396),Circle:i(353),RegularPolygon:i(27),Polygon:i(551)};t.exports=class{constructor(t){let e=this;for(let i of Object.keys(s))e[i]=function(...e){return new s[i](t,...e)}}}},353:(t,e,i)=>{const s=i(301),n=i(811);class r extends s{static createVertices(t,e=0){e=e||Math.round(2.8*Math.pow(t,1/3));let i=2*Math.PI/e,s=[];for(let r=0;r<e;r++)s.push(new n(Math.cos(i*r+i/2)*t,Math.sin(i*r+i/2)*t));return s}constructor(t,e,i,s={}){super(t,r.createVertices(e,s.verticeCount),i,s),this.radius=e,this.nodeType="Circle"}addPolygonRender(t,e){return super.addPolygonRender({position:new n(this.position),vertices:this.vertices,subtype:"Circle",radius:this.radius,angle:this.angle,...t},e),this}addSprite(t,e){return super.addSprite({position:new n(this.position),width:2*this.radius,height:2*this.radius,angle:this.angle,...t},e),this}}t.exports=r},551:(t,e,i)=>{const s=i(301),n=i(811);t.exports=class extends s{static createVertices(t,e=0){e=e||Math.round(2.8*Math.pow(t,1/3));let i=2*Math.PI/e,s=[];for(let r=0;r<e;r++)s.push(new n(Math.cos(i*r+i/2)*t,Math.sin(i*r+i/2)*t));return s}constructor(t,e,i,s={}){super(t,e,i,s),this.nodeType="Polygon"}addPolygonRender(t,e){return super.addPolygonRender({position:new n(this.position),vertices:this.vertices,subtype:"Polygon",angle:this.angle,...t},e),this}addSprite(t,e){return super.addSprite({position:new n(this.position),angle:this.angle,...t},e),this}}},396:(t,e,i)=>{const s=i(301),n=i(811);i(219),i(416);class r extends s{static createVertices(t,e){return[new n(-t/2,e/2),new n(t/2,e/2),new n(t/2,-e/2),new n(-t/2,-e/2)]}constructor(t,e,i,s,n={}){super(t,r.createVertices(e,i),s,n),this.width=e,this.height=i,this.nodeType="Rectangle"}addPolygonRender(t,e){return super.addPolygonRender({position:new n(this.position),vertices:this.vertices,subtype:"Rectangle",width:this.width,height:this.height,angle:this.angle,...t},e),this}addSprite(t,e){return super.addSprite({position:new n(this.position),width:this.width,height:this.height,...t},e),this}}t.exports=r},27:(t,e,i)=>{const s=i(301),n=i(811);class r extends s{static createVertices(t,e=0){e=e||Math.round(2.8*Math.pow(t,1/3));let i=2*Math.PI/e,s=[];for(let r=0;r<e;r++)s.push(new n(Math.cos(i*r+i/2)*t,Math.sin(i*r+i/2)*t));return s}constructor(t,e,i,s,n={}){super(t,r.createVertices(e,i),s,n),this.radius=e,this.nodeType="RegularPolygon"}addPolygonRender(t,e){return super.addPolygonRender({position:new n(this.position),vertices:this.vertices,angle:this.angle,subtype:"RegularPolygon",...t},e),this}addSprite(t,e){return super.addSprite({position:new n(this.position),width:2*this.radius,height:2*this.radius,angle:this.angle,...t},e),this}}t.exports=r},929:(t,e,i)=>{const s=i(811);let n={clamp:function(t,e,i){return Math.max(e,Math.min(t,i))},angleDiff:function(t,e){return i=t-e+Math.PI,s=2*Math.PI,i-Math.floor(i/s)*s-Math.PI;var i,s},modDiff:function(t,e,i=1){return n=i,(s=t-e+i/2)-Math.floor(s/n)*n-i/2;var s,n},pair:function(t,e){return t>e?t*t+t+e:e*e+t},unpair:function(t){let e=Math.floor(Math.sqrt(t)),i=t-e*e;return i<e?new s(i,e):new s(e,i-e)},pairCommon:function(t,e){return t>e?t*t+t+e:e*e+e+t},getCenterOfMass(t){let e=new s(0,0),i=0,n=0,r=t.length;for(let a=0;a<t.length;a++){let o=t[a],l=t[(a+1)%r];n=o.x*l.y-l.x*o.y,i+=n,e.add2(new s((o.x+l.x)*n,(o.y+l.y)*n))}return e.div2(3*i),e},parseColor:function(t){if("transparent"===t)return["#000000",0];let e,i=1;if("#"===t[0]){if(9===t.length)e=t.slice(0,7),i=parseInt(t.slice(7),16)/256;else if(7===t.length)e=t;else if(4===t.length){let i=t[1],s=t[2],n=t[3];e="#"+i+i+s+s+n+n}else if(3===t.length){let i=t[1]+t[2];e="#"+i+i+i}}else"rgb("===t.slice(0,4)?(e=t.slice(t.indexOf("(")+1,t.indexOf(")")).split(","),e="#"+e.map((t=>parseInt(t).toString(16).padStart(2,"0"))).join(""),i=1):"rgba("===t.slice(0,5)&&(e=t.slice(t.indexOf("(")+1,t.indexOf(")")).split(","),i=parseInt(e.pop())/255,e="#"+e.map((t=>parseInt(t).toString(16).padStart(2,"0"))).join(""));return e||(e="#000000"),[e,i]},merge:function(t,e,i=1/0,s=new WeakSet){s.add(e),Object.keys(e).forEach((r=>{let a=e[r],o=a instanceof Element||a instanceof Document||a===window;if(Array.isArray(a)&&i>1)t[r]=[...a];else if("object"==typeof a&&null!==a&&!o&&i>1){if(s.has(a))return void(t[r]=a);"object"!=typeof t[r]&&(t[r]={}),n.merge(t[r],a,i-1,s)}else t[r]=a}))},isClass:function(t){const e=t.constructor&&"class"===t.constructor.toString().substring(0,5);if(void 0===t.prototype)return e;const i=t.prototype.constructor&&t.prototype.constructor.toString&&"class"===t.prototype.constructor.toString().substring(0,5);return e||i},lineIntersects:function(t,e,i,n){t.x!==e.x&&t.y!==e.y||(t=new s(t)),i.x!==n.x&&i.y!==n.y||(i=new s(i)),t.x===e.x&&(t.x+=1e-5),i.x===n.x&&(i.x+=1e-5),t.y===e.y&&(t.y+=1e-5),i.y===n.y&&(i.y+=1e-5);let r=(t.x-e.x)*(i.y-n.y)-(t.y-e.y)*(i.x-n.x);if(0===r)return null;let a=(t.x*e.y-t.y*e.x)*(i.x-n.x)-(t.x-e.x)*(i.x*n.y-i.y*n.x),o=(t.x*e.y-t.y*e.x)*(i.y-n.y)-(t.y-e.y)*(i.x*n.y-i.y*n.x),l=new s(a/r,o/r),h=l.x>Math.min(t.x,e.x)&&l.x<Math.max(t.x,e.x)&&l.x>Math.min(i.x,n.x)&&l.x<Math.max(i.x,n.x),d=l.y>Math.min(t.y,e.y)&&l.y<Math.max(t.y,e.y)&&l.y>Math.min(i.y,n.y)&&l.y<Math.max(i.y,n.y);return h&&d?l:null},lineIntersectsBody:function(t,e,i){if(i.children.length>0){for(let s of i.children)if(n.lineIntersectsBody(t,e,s))return!0;return!1}let s=e.sub(t).normalize(),r=[s,s.normal()],a=[t,e];function o(t,e,i){for(let s of i){let i={min:1/0,max:-1/0},n={min:1/0,max:-1/0};for(let e of t){let t=e.dot(s);t<i.min&&i.minVertice,i.min=Math.min(i.min,t),i.max=Math.max(i.max,t)}for(let t of e){let e=t.dot(s);n.min=Math.min(n.min,e),n.max=Math.max(n.max,e)}if(i.min>n.max||i.max<n.min)return!1}return!0}return o(a,i.vertices,r)&&o(a,i.vertices,i.axes)},getRayNearbyStaticBodies(t,e,i){let n=i.staticGrid,r=n.gridSize,a={min:t.min(e).div2(r).floor2(),max:t.max(e).div2(r).floor2()},o=new Set;for(let t=a.min.x;t<=a.max.x;t++)for(let e=a.min.y;e<=a.max.y;e++){let i=n.pair(new s(t,e)),r=n.grid[i];if(r)for(let t of r)o.has(t)||o.add(t)}},getRayNearbyDynamicBodies(t,e,i){let n=i.dynamicGrid,r=n.gridSize,a={min:t.min(e).div2(r).floor2(),max:t.max(e).div2(r).floor2()},o=new Set;for(let t=a.min.x;t<=a.max.x;t++)for(let e=a.min.y;e<=a.max.y;e++){let i=n.pair(new s(t,e)),r=n.grid[i];if(r)for(let t of r)o.has(t)||o.add(t)}},raycast:function(t,e,i=[]){let s=n.lineIntersects,r=1/0,a=null,o=null,l=-1;for(let n=0;n<i.length;n++){let h=i[n],{vertices:d}=h,c=d.length;for(let i=0;i<c;i++){let n=s(t,e,d[i],d[(i+1)%c]);if(n){let e=n.sub(t).length;e<r&&(r=e,a=n,o=h,l=i)}}}return{collision:null!==a,distance:r,point:a,body:o,verticeIndex:l}},raycastSimple:function(t,e,i){let s=n.lineIntersectsBody;for(let n of i)if(s(t,e,n))return!0;return!1},boundCollision:function(t,e){return t.max.x>=e.min.x&&t.min.x<=e.max.x&&t.max.y>=e.min.y&&t.min.y<=e.max.y},pointInBounds:function(t,e){return t.x>=e.min.x&&t.x<=e.max.x&&t.y>=e.min.y&&t.y<=e.max.y},arrayDelete(t,e){let i=t.indexOf(e);-1!==i&&t.splice(i,1)}};t.exports=n},830:(t,e,i)=>{const s=i(569),n=i(681),r=i(334),a=i(726),o=i(929),l=i(763),h=i(754),d=i(789);class c{static defaultOptions={World:s.defaultOptions,Render:n.defaultOptions,Engine:a.defaultOptions,Ticker:h.defaultOptions};constructor(t={}){let e={...c.defaultOptions};o.merge(e,t,2),t=e,this.World=new s(t.World),this.Engine=new a(this.World,t.Engine),this.Render=new n(t.Render),this.Ticker=new h(this,t.Ticker),this.Bodies=new d(this)}createDebugRender(){this.DebugRender=new r(this);let t=this.Engine.Performance;t.render=new l(t,this.Render)}}t.exports=c},656:(t,e,i)=>{const s=i(763);t.exports=class{getAvgs=!0;#t=0;fps=60;delta=1;frame=0;history={avgFps:60,avgDelta:1,fps:[],delta:[]};engine={delta:0,lastUpdate:0};render;constructor(t=void 0){t&&(this.render=new s(this,t)),this.#t=performance.now()/1e3}update(){let t=performance.now()/1e3;if(t-this.#t==0)return;this.delta=Math.min(5,t-this.#t),this.fps=1/this.delta,this.#t=t,this.history.fps.push(this.fps),this.history.delta.push(this.delta),this.history.fps.length>200&&(this.history.fps.shift(),this.history.delta.shift());let e=(()=>{let t=0;for(let e=0;e<this.history.fps.length;e++)t+=this.history.fps[e];return t/this.history.fps.length})(),i=(()=>{let t=0;for(let e=0;e<this.history.delta.length;e++)t+=this.history.delta[e];return t/this.history.delta.length})();this.history.avgFps=e,this.history.avgDelta=i}}},754:(t,e,i)=>{const s=i(929),n=i(847);class r{static defaultOptions={enabled:!0,pauseOnFreeze:!0,freezeThreshold:.3};#e=!0;constructor(t,e={}){let i={...r.defaultOptions};s.merge(i,e,1),e=i,this.Game=t,this.#e=e.enabled,this.pauseOnFreeze=e.pauseOnFreeze,this.freezeThreshold=e.freezeThreshold,this.tick=this.tick.bind(this),this.#e&&window.addEventListener("load",this.tick)}start(){this.#e||(this.#e=!0,this.tick())}stop(){this.#e&&(this.#e=!1)}tick(){if(!this.#e)return;this.trigger("beforeTick");const{Engine:t}=this.Game,{Performance:e}=t;this.pauseOnFreeze&&e.fps/Math.max(1,e.history.avgFps)<this.freezeThreshold?e.update():t.update(),n.update(),this.trigger("afterTick"),requestAnimationFrame(this.tick)}#i={beforeTick:[],afterTick:[]};on(t,e){this.#i[t]?this.#i[t].push(e):console.warn(t+" is not a valid event")}off(t,e){(t=this.#i[t]).includes(e)&&t.splice(t.indexOf(e),1)}trigger(t){this.#i[t]&&this.#i[t].forEach((t=>{t()}))}}t.exports=r},506:(t,e,i)=>{"use strict";const s=i(811);t.exports=class{constructor(t,e,i,n){t.a&&t.b?(this.a=new s(t.a),this.b=new s(t.b),this.c=new s(t.c),this.d=new s(t.d)):(this.a=new s(t),this.b=new s(e),this.c=new s(i),this.d=new s(n)),this.length=this.getLength()}getAtT(t){let e=this.a.x*(1-t)**3+3*this.b.x*t*(1-t)**2+3*this.c.x*(1-t)*t**2+this.d.x*t**3,i=this.a.y*(1-t)**3+3*this.b.y*t*(1-t)**2+3*this.c.y*(1-t)*t**2+this.d.y*t**3;return new s(e,i)}getLength(t=.01){let e=this.getAtT(0),i=0;for(let s=t;s<=1;s+=t){let t=this.getAtT(s);i+=t.sub(e).length,e=t}return i+=this.getAtT(1).sub(e).length,i}get(t){return this.getAtT(t/this.length)}getDxAtT(t){let e=3*((this.d.x-3*this.c.x+3*this.b.x-this.a.x)*t**2+(2*this.c.x-4*this.b.x+2*this.a.x)*t+this.b.x-this.a.x),i=3*((this.d.y-3*this.c.y+3*this.b.y-this.a.y)*t**2+(2*this.c.y-4*this.b.y+2*this.a.y)*t+this.b.y-this.a.y);return new s(e,i)}getDx(t){return this.getDxAtT(t/this.length)}getDx2AtT(t){let e=6*((this.d.x-3*this.c.x+3*this.b.x-this.a.x)*t+this.c.x-2*this.b.x+this.a.x),i=6*((this.d.y-3*this.c.y+3*this.b.y-this.a.y)*t+this.c.y-2*this.b.y+this.a.y);return new s(e,i)}getDx2(t){return this.getDx2AtT(t/this.length)}toObject(){return{a:this.a.toObject(),b:this.b.toObject(),c:this.c.toObject(),d:this.d.toObject()}}}},60:(t,e,i)=>{const s=i(811);t.exports=class{min=new s(0,0);max=new s(0,0);constructor(t,e){Array.isArray(t)?this.update(t):t.min&&t.max?(this.min.set(t.min),this.max.set(t.max)):(this.min.set(t),this.max.set(e))}update(t){let e=1/0,i=1/0,s=-1/0,n=-1/0;for(let r=0;r<t.length;r++){let a=t[r];a.x<e&&(e=a.x),a.x>s&&(s=a.x),a.y<i&&(i=a.y),a.y>n&&(n=a.y)}this.min.x=e,this.min.y=i,this.max.x=s,this.max.y=n}randomPoint(){let{max:t,min:e}=this,i=Math.random()*(t.x-e.x)+e.x,n=Math.random()*(t.y-e.y)+e.y;return new s(i,n)}}},953:(t,e,i)=>{"use strict";const{arrayDelete:s}=i(929),n=i(811);class r{static id=0;grid={};gridIds=new Set;gridSize=2e3;constructor(t=2e3){this.gridSize=t,this.id=r.id++}pair(t){let e=t.x>=0?2*t.x:-2*t.x-1,i=t.y>=0?2*t.y:-2*t.y-1;return e>=i?e*e+e+i:i*i+e}unpair(t){let e=Math.floor(Math.sqrt(t)),i=e*e,s=t-i>=e?new n(e,t-i-e):new n(t-i,e),r=s.x%2==0?s.x/2:(s.x+1)/-2,a=s.y%2==0?s.y/2:(s.y+1)/-2;return new n(r,a)}getBounds(t){let e=this.gridSize;if("object"==typeof t.bounds)return this.getBounds(t.bounds);if("object"==typeof t.max&&"object"==typeof t.min)return{min:t.min.div(e).floor2(),max:t.max.div(e).floor2()};if(void 0!==t.x&&void 0!==t.y){let i=Math.floor(t.x/e),s=Math.floor(t.y/e);return{min:new n(i,s),max:new n(i,s)}}}getBucketIds(t){let e=[];for(let i=t.min.x;i<=t.max.x;i++)for(let s=t.min.y;s<=t.max.y;s++){let t=this.pair(new n(i,s));this.grid[t]&&e.push(t)}return e}getBuckets(t){return this.getBucketIds(this.getBounds(t)).map((t=>this.grid[t]))}addBody(t){let e=this.getBounds(t);if(!e)throw console.error(t),new Error("Could not find bounds of body");t._Grids||(t._Grids={}),t._Grids[this.id]||(t._Grids[this.id]=[]);for(let i=e.min.x;i<=e.max.x;i++)for(let s=e.min.y;s<=e.max.y;s++){let e=this.pair(new n(i,s));t._Grids[this.id].push(e),this.grid[e]||(this.grid[e]=[],this.gridIds.add(e)),this.grid[e].push(t)}}removeBody(t){for(let e of t._Grids[this.id]){let i=this.grid[e];i&&(s(i,t),0===i.length&&(delete this.grid[e],this.gridIds.delete(e)))}delete t._Grids[this.id]}addPoint(t){t._Grids||(t._Grids={}),t._Grids[this.id]||(t._Grids[this.id]=[]);let e=(void 0!==t.x?t:t.position).div(this.gridSize).floor2(),i=this.pair(e);t._Grids[this.id].push(i),this.grid[i]||(this.grid[i]=[],this.gridIds.add(i)),this.grid[i].push(t)}removePoint(t){if(!t._Grids)throw console.error(t),new Error("Can't remove point that isn't in grid");for(let e of t._Grids[this.id]){let i=this.grid[e];i&&(s(i,t),0===i.length&&(delete this.grid[e],this.gridIds.delete(e)))}delete t._Grids[this.id]}updateBody(t){let e=t._Grids[this.id],i=new Set(e),r=this.getBounds(t);if(!r)throw console.error(t),new Error("Could not find bounds of body");for(let s=r.min.x;s<=r.max.x;s++)for(let a=r.min.y;a<=r.max.y;a++){let r=this.pair(new n(s,a));i.has(r)?i.delete(r):(e.push(r),this.grid[r]||(this.grid[r]=[],this.gridIds.add(r)),this.grid[r].push(t))}for(let n of i){let i=this.grid[n];s(e,n),i&&(s(i,t),0===i.length&&(delete this.grid[n],this.gridIds.delete(n)))}}}t.exports=r},811:t=>{class e{constructor(t,e){return"object"==typeof t?Array.isArray(t)?(this.x=t[0],this.y=t[1]):(this.x=t.x,this.y=t.y):"number"==typeof t&&void 0===e?(this.x=Math.cos(t),this.y=Math.sin(t)):(this.x=t,this.y=e),this}add(t){return"number"==typeof t?new e(this.x+t,this.y+t):new e(this.x+t.x,this.y+t.y)}sub(t){return"number"==typeof t?new e(this.x-t,this.y-t):new e(this.x-t.x,this.y-t.y)}mult(t){return"number"==typeof t?new e(this.x*t,this.y*t):new e(this.x*t.x,this.y*t.y)}div(t){return"number"==typeof t?new e(this.x/t,this.y/t):new e(this.x/t.x,this.y/t.y)}add2(t){return"number"==typeof t?(this.x+=t,this.y+=t,this):(this.x+=t.x,this.y+=t.y,this)}sub2(t){return"number"==typeof t?(this.x-=t,this.y-=t,this):(this.x-=t.x,this.y-=t.y,this)}mult2(t){return"number"==typeof t?(this.x*=t,this.y*=t,this):(this.x*=t.x,this.y*=t.y,this)}div2(t){return"number"==typeof t?(this.x/=t,this.y/=t,this):(this.x/=t.x,this.y/=t.y,this)}pow(t){return"number"==typeof t?new e(this.x**t,this.y**t):new e(this.x**t.x,this.y**t.y)}pow2(t){return"number"==typeof t?(this.x=this.x**t,this.y=this.y**t,this):(this.x=this.x**t.x,this.y=this.y**t.y,this)}sign(){return new e(Math.sign(this.x),Math.sign(this.y))}sign2(){return this.x=Math.sign(this.x),this.y=Math.sign(this.y),this}mod(t){return"number"==typeof t?new e(this.x%t,this.y%t):new e(this.x%t.x,this.y%t.y)}mod2(t){return"number"==typeof t?(this.x%=t,this.y%=t):(this.x%=t.x,this.y%=t.y),this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return"number"==typeof t?new e(-t*this.y,t*this.x):this.x*t.y-this.y*t.x}avg(t,i=.5){let s=1-i;return new e(this.x*i+t.x*s,this.y*i+t.y*s)}get length(){return Math.sqrt(this.x*this.x+this.y*this.y)}set length(t){let e=t/this.length;this.x*=e,this.y*=e}get angle(){return Math.atan2(this.y,this.x)}get area(){return this.x*this.y}manhattan(t){return Math.abs(t.x-this.x)+Math.abs(t.y-this.y)}abs(){return new e(Math.abs(this.x),Math.abs(this.y))}abs2(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this}reflect(t){let e=t.normal();return this.sub(e.mult(2*e.dot(this)))}reflect2(t){let e=t.normal();return this.sub2(e.mult(2*e.dot(this)))}rotate(t){return new e(Math.cos(t)*this.x-Math.sin(t)*this.y,Math.sin(t)*this.x+Math.cos(t)*this.y)}rotate2(t){let e=Math.cos(t)*this.x-Math.sin(t)*this.y;return this.y=Math.sin(t)*this.x+Math.cos(t)*this.y,this.x=e,this}project(t,i=!1){let s=this.dot(t),n=t.x*t.x+t.y*t.y;return i&&(s=Math.max(0,Math.min(n,s))),new e(s*t.x/n,s*t.y/n)}project2(t,e=!1){let i=this.dot(t),s=t.x*t.x+t.y*t.y;return e&&(i=Math.max(0,Math.min(s,i))),this.x=i*t.x/s,this.y=i*t.y/s,this}normalize(){let t=this.length;return 0===t?new e(this):new e(this.x/t,this.y/t)}normalize2(){let t=this.length;return 0===t||(this.x/=t,this.y/=t),this}normal(){return new e(this.y,-this.x)}normal2(){let t=this.y;return this.y=-this.x,this.x=t,this}floor(){return new e(Math.floor(this.x),Math.floor(this.y))}floor2(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return new e(Math.ceil(this.x),Math.ceil(this.y))}ceil2(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return new e(Math.round(this.x),Math.round(this.y))}round2(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}min(t){return new e(Math.min(t.x,this.x),Math.min(t.y,this.y))}min2(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return new e(Math.max(t.x,this.x),Math.max(t.y,this.y))}max2(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,i){return new e(Math.max(t.x,Math.min(i.x,this.x)),Math.max(t.y,Math.min(i.y,this.y)))}clamp2(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}equals(t){return this.x===t.x&&this.y===t.y}set(t){return this.x=t.x,this.y=t.y,this}toString(){return`{ x: ${this.x}, y: ${this.y} }`}toStringInt(){return`{ x: ${Math.round(this.x)}, y: ${Math.round(this.y)} }`}toObject(){return{x:this.x,y:this.y}}toArray(){return[this.x,this.y]}isNaN(){return isNaN(this.x)||isNaN(this.y)}}t.exports=e},593:(t,e,i)=>{"use strict";const s=i(811),n=i(929);class r{static id=0;static getUniqueId(){return++r.id}nodeType="Node";position=new s(0,0);angle=0;children=new Set;#s=!1;constructor(t=new s(0,0)){this.id=r.getUniqueId(),this.position=new s(t)}add(){if(!this.#s){this.trigger("add"),this.#s=!0;for(let t of this.children)t.add()}return this}delete(){if(this.#s){this.trigger("delete"),this.#s=!1;for(let t of this.children)t.delete()}return this}isAdded(){return this.#s}addChild(...t){for(let e of t)this.children.add(e)}removeChild(...t){for(let e of t)this.children.delete(e)}setPosition(t){if(!t instanceof s)throw new Error("position must be a vec");let e=t.sub(this.position);this.translate(e)}translate(t){if(!t instanceof s)throw new Error("positionDelta must be a vec");this.position.add2(t);for(let e of this.children)e.translate(t)}setAngle(t,e=this.position){if(!isNaN(t)&&t!==this.angle){let i=n.angleDiff(t,this.angle);this.translateAngle(i,e)}}translateAngle(t,e=this.position,i=!0){if(!isNaN(t)){if(this.angle+=t,i){let i=Math.sin(t),n=Math.cos(t),r=this.position.sub(e),a=new s(r.x*n-r.y*i,r.x*i+r.y*n).add(e);this.setPosition(a)}for(let i of this.children)i.translateAngle?.(t,e)}}#i={delete:[],add:[]};on(t,e){this.#i[t]?this.#i[t].push(e):console.warn(t+" is not a valid event")}off(t,e){let i=this.#i[t];i.includes(e)&&i.splice(i.indexOf(e),1)}trigger(t,...e){this.#i[t]&&this.#i[t].forEach((t=>{t(...e)}))}}t.exports=r},569:(t,e,i)=>{const s=i(593),n=i(929),r=i(953),a=i(811),o=i(301),l=i(769);class h extends s{static defaultOptions={gravity:new a(0,500),gridSize:500};gravity=new a(0,0);timescale=1;time=0;rigidBodies=new Set;constraints=new Set;pairs={};dynamicGrid;staticGrid;globalPoints=[];globalVectors=[];constructor(t={}){super();let e={...h.defaultOptions};n.merge(e,t,1),t=e;let{gravity:i,gridSize:s}=t;this.gravity=new a(i),this.dynamicGrid=new r(s),this.staticGrid=new r(s)}canCollide(t,e){let{layer:i,mask:s}=t,{layer:n,mask:r}=e;return!!(s&n)||!!(r&i)}#n(t){let e=[],i=this.canCollide;for(let s=0;s<t.length-1;s++){let n=t[s];if(n.parentNode.hasCollisions)for(let r=s+1;r<t.length;r++){let s=t[r];if(!s.parentNode.hasCollisions||n.parentNode===s.parentNode)continue;if(!i(n.parentNode.collisionFilter,s.parentNode.collisionFilter))continue;const a=n.bounds,o=s.bounds;a.min.x<=o.max.x&&a.max.x>=o.min.x&&a.min.y<=o.max.y&&a.max.y>=o.min.y&&e.push([n,s])}}return e}get collisionPairs(){let t=this.canCollide,e=this.dynamicGrid,i=this.staticGrid,s=n.pairCommon,r=new Set,a=[],o=e.grid,l=i.grid,h=e.gridIds;for(let e of h){let i=o[e],n=l[e],h=this.#n(i);if(n)for(let e=0;e<i.length;e++){let s=i[e];if(s.parentNode.hasCollisions)for(let e=0;e<n.length;e++){let i=n[e];if(!i.parentNode.hasCollisions||s.parentNode.isStatic&&i.parentNode.isStatic||s.parentNode===i.parentNode)continue;if(!t(s.parentNode.collisionFilter,i.parentNode.collisionFilter))continue;const r=s.bounds,a=i.bounds;r.min.x<=a.max.x&&r.max.x>=a.min.x&&r.min.y<=a.max.y&&r.max.y>=a.min.y&&h.push([s,i])}}for(let t=0;t<h.length;t++){let e=h[t],i=s(e[0].id,e[1].id);r.has(i)||(r.add(i),a.push(e))}}return a}addChild(...t){super.addChild(...t);for(let e of t)if(e instanceof o){this.rigidBodies.add(e);for(let t of e.children)t instanceof l&&(e.isStatic?this.staticGrid.addBody(t):this.dynamicGrid.addBody(t))}}removeChild(...t){super.removeChild(...t);for(let e of t)if(e instanceof o){this.rigidBodies.delete(e);for(let t of e.children)t._Grids&&(t._Grids[this.staticGrid.id]&&this.staticGrid.removeBody(t),t._Grids[this.dynamicGrid.id]&&this.dynamicGrid.removeBody(t))}}}t.exports=h},847:t=>{"use strict";class e{static ease={linear:t=>t,in:{sine:t=>1-Math.cos(t*Math.PI/2),quadratic:t=>t**2,cubic:t=>t**3,quartic:t=>t**4,quintic:t=>t**5,exponential:t=>0===t?0:pow(2,10*t-10),circular:t=>1-Math.sqrt(1-Math.pow(t,2)),back:t=>2.70158*t**3-1.70158*t**2},out:{sine:t=>Math.sin(t*Math.PI/2),quadratic:t=>1-(1-t)**2,cubic:t=>1-Math.pow(1-t,3),quartic:t=>1-Math.pow(1-t,4),quintic:t=>1-Math.pow(1-t,5),exponential:t=>1===t?1:1-Math.pow(2,-10*t),circular:t=>Math.sqrt(1-Math.pow(t-1,2)),back:t=>1+3*Math.pow(t-1,3)+2*Math.pow(t-1,2)},inOut:{sine:t=>-(Math.cos(Math.PI*t)-1)/2,quadratic:t=>t<.5?2*t**2:1-Math.pow(-2*t+2,2)/2,cubic:t=>t<.5?4*t**3:1-Math.pow(-2*t+2,3)/2,quartic:t=>t<.5?8*t**4:1-Math.pow(-2*t+2,4)/2,quintic:t=>t<.5?16*t**5:1-Math.pow(-2*t+2,5)/2,exponential:t=>0===t?0:1===t?1:t<.5?Math.pow(2,20*t-10)/2:(2-Math.pow(2,-20*t+10))/2,circular:t=>t<.5?(1-Math.sqrt(1-Math.pow(2*t,2)))/2:(Math.sqrt(1-Math.pow(-2*t+2,2))+1)/2,back:t=>{const e=2.5949095;return t<.5?Math.pow(2*t,2)*(7.189819*t-e)/2:(Math.pow(2*t-2,2)*((e+1)*(2*t-2)+e)+2)/2}}};static queued=new Set;static running=new Set;static update(){for(let t of e.queued)t.getTime()>=0&&(e.queued.delete(t),e.running.add(t));for(let t of e.running)t.tick()}#r=!1;isRunning(){return this.#r}constructor({duration:t=0,curve:i=e.ease.linear,delay:s=0,onstop:n,onend:r,ontick:a,World:o=null}){this.duration=t,this.curve=i,this.delay=s,this.onstop=n,this.onend=r,this.ontick=a,this.World=o}run(){if(!this.#r){this.#r=!0,this.startTime=this.getTimeRaw(),e.queued.add(this);let t=this;return new Promise(((e,i)=>{t.resolve=e,t.reject=i}))}}getTimeRaw(){return this.World?this.World.time:performance.now()/1e3}getTime(){return(this.World?this.World.time:performance.now()/1e3)-this.startTime-this.delay}tick(){if(!this.#r)return;let t=this.getTime(),e=Math.max(this.duration,1e-11),i=Math.max(0,Math.min(1,this.curve(t/e)));this.ontick&&this.ontick(i),t/e>=1&&this.end()}stop(){this.#r&&(this.#r=!1,this.onstop&&this.onstop(),this.resolve&&this.resolve(!1),e.queued.delete(this),e.running.delete(this))}end(){this.#r&&(this.#r=!1,this.onend&&this.onend(),this.resolve&&this.resolve(!0))}}t.exports=e},218:(t,e,i)=>{const s=i(847);class n{static all=new Set;static update(){const t=performance.now();for(let e of n.all){let{startTime:i,duration:s,frames:n,lastFrame:r,curve:a,totalLoops:o,loopNumber:l}=e,h=Math.max(0,Math.min(1,(t-i)/s)),d=a(h);h>=1&&(l+1<o?(e.loopNumber++,e.startTime=t,d=a(0)):(e.lastFrame=n-1,e.stop&&e.stop()));let c=Math.floor(d*n);e.frame=c,d<1&&c!==r&&(e.lastFrame=c,e.callback&&e.callback(c))}}constructor({frames:t,duration:e=200,curve:i=s.ease.linear,callback:r,onstart:a,onend:o,totalLoops:l=1,autostart:h=!1}){this.frame=0,this.frames=t,this.duration=e,this.startTime=performance.now(),this.curve=i,this.pauseTime=0,this.lastFrame=-1,this.loopNumber=0,this.totalLoops=l??1,this.callback=r,this.onstart=a,this.onend=o,this.playing=!1,h&&l>0&&(n.all.add(this),"function"==typeof this.onstart&&this.onstart())}stop(){this.playing&&("function"==typeof this.onend&&this.onend(),n.all.delete(this),this.pauseTime=0,this.lastFrame=-1,this.loopNumber=0,this.playing=!1)}pause(){this.playing&&(n.all.delete(this),this.pauseTime=performance.now()-this.startTime,this.playing=!1)}start(){this.startTime=performance.now()-this.pauseTime,n.all.add(this),this.playing=!0,0===this.pauseTime&&"function"==typeof this.onstart&&this.onstart()}}t.exports=n},794:(t,e,i)=>{i(811);let s={createElement:function(t,e){let i=document.createElement(t);return function t(e,i){Object.keys(i).forEach((s=>{if("object"!=typeof i[s]||Array.isArray(s)||i[s]instanceof Element)if("class"===s){let t="string"==typeof i[s]?i[s].split(" "):i[s];for(let i of t)e.classList.add(i)}else"parent"===s?i[s].appendChild(e):e[s]=i[s];else e[s]||(e[s]={}),t(e[s],i[s])}))}(i,e),i}};t.exports=s},764:t=>{t.exports=class{constructor(){window.addEventListener("keydown",(t=>this.#a.call(this,t))),window.addEventListener("keyup",(t=>this.#o.call(this,t))),window.addEventListener("mousedown",(t=>this.#l.call(this,t))),window.addEventListener("mouseup",(t=>this.#h.call(this,t)))}#a(t){if(t.repeat)return;let e=t.key.toLowerCase(),i=(t.ctrlKey?"ctrl":"")+(t.altKey?"alt":"")+(t.shiftKey?"shift":"")+e;this.#d.add(e),this.#c[i]?this.trigger(i,!0):this.#c[e]&&this.trigger(e,!0)}#o(t){if(t.repeat)return;let e=t.key.toLowerCase(),i=(t.ctrlKey?"ctrl":"")+(t.altKey?"alt":"")+(t.shiftKey?"shift":"")+e;this.#d.delete(e),this.#c[i]?this.trigger(i,!1):this.#c[e]&&this.trigger(e,!1)}#l(t){let e="mouse"+t.button;this.#c[e]&&this.trigger(e,!0)}#h(t){let e="mouse"+t.button;this.#c[e]&&this.trigger(e,!1)}blockRightClick(){window.addEventListener("contextmenu",(t=>{t.preventDefault()}))}isValidKeyEvent(t){return" "===t||0===t.replace(/(ctrl)?(alt)?(shift)?[a-zA-Z]+/i,"").length}isValidMouseEvent(t){return 0===t.replace(/(mouse)\d+/i,"").length}isPressed(...t){if(0===t.length)return!1;for(let e of t)if(!this.#d.has(e))return!1;return!0}#d=new Set;#c={};on(t,e){t=t.toLowerCase(),this.isValidKeyEvent(t)||this.isValidMouseEvent(t)?(this.#c[t]||(this.#c[t]=[]),this.#c[t.toLowerCase()].push(e)):console.warn(t+" is not a valid event")}off(t,e){let i=this.#c[t];i.includes(e)&&i.splice(i.indexOf(e),1)}trigger(t,...e){this.#c[t]&&this.#c[t].forEach((t=>{t(...e)}))}}},769:(t,e,i)=>{const s=i(811),n=i(593),r=i(929),a=i(60);t.exports=class extends n{nodeType="CollisionShape";Engine;parent;position=new s(0,0);angle=0;_axes=[];pairs=[];_lastSeparations={};bounds;constructor(t,e,i){super(),this.vertices=e.map((t=>new s(t))),this.Engine=i,this.parentNode=t,this.bounds=new a(this.vertices),this.#u(),this._resetVertices(),this._resetVertices()}add(){return super.add(),this}delete(){if(this.isAdded()){super.delete();for(let t=0;t<this.pairs.length;t++)this.Engine.cleansePair(this.pairs[t])}return this}setPosition(t){let e=t.sub(this.position);this.translate(e)}translate(t){if(t.isNaN()||0===t.x&&0===t.y)return;let e=this.vertices;for(let i=0;i<e.length;i++)e[i].add2(t);this.position.add2(t),this.bounds.update(this.vertices);let i=this.Engine.World.dynamicGrid;this._Grids&&this._Grids[i.id]&&i.updateBody(this);let s=this.children;for(let e of s)e.translate(t)}setAngle(t,e){if(!isNaN(t)&&t!==this.angle){let i=r.angleDiff(t,this.angle);this.translateAngle(i,e)}}translateAngle(t,e=this.parentNode.rotationPoint.rotate(this.angle+t).add(this.parentNode.position)){if(isNaN(t))return;let i=this.vertices,s=Math.sin(t),n=Math.cos(t);for(let t=i.length;t-- >0;){let r=i[t],a=r.sub(e);r.x=this.parentNode.position.x+(a.x*n-a.y*s),r.y=this.parentNode.position.y+(a.x*s+a.y*n)}this.bounds.update(this.vertices),this.#p(),super.translateAngle(t,e,!1)}#u(t=1){let e=this.vertices;for(let i=0;i<e.length;i++){let s=e[i];for(let n=0;n<e.length;n++){if(n===i)continue;let r=e[n],a=s.sub(r);if(Math.abs(a.x)+Math.abs(a.y)<t){e.splice(i,1),i--;break}}}}_resetVertices(){this.#f(!0),this.area=this.#g(),this.#y(),this.bounds.update(this.vertices),this.#p()}#f(t=!1){if(t){let t=this.vertices,e=this.position,i=t.map((t=>[t,t.sub(e).angle]));i.sort(((t,e)=>r.angleDiff(t[1],e[1]))),this.vertices=i.map((t=>t[0]))}else{let t=this.vertices,e=this.position,i=t.map((t=>t.sub(e).angle));r.angleDiff(i[0],i[1])>0&&this.vertices.reverse()}}#g(){let t=0,e=this.vertices,i=e.length;for(let s=0;s<i;s++)t+=e[s].cross(e[(s+1)%i]);return.5*t}#y(){let t=this.#m();this.position.set(t)}#m(){return r.getCenterOfMass(this.vertices)}#p(){let t=this.vertices,e=[];for(let i=0;i<t.length;i++){let s=t[i],n=t[(i+1)%t.length];e.push(n.sub(s))}for(let t=0;t<e.length;t++)e[t]=e[t].normal().normalize2();this._axes=e}_getSupport(t,e=this.position){let i,s=this.vertices,n=-1/0;for(let r=0;r<s.length;r++){let a=t.dot(s[r].sub(e));a>n&&(n=a,i=r)}return[i,n]}containsPoint(t,e=0){let i=this.vertices;for(let s=0;s<i.length;s++){let n=i[s],r=i[(s+1)%i.length];if((t.x-n.x)*(r.y-n.y)+(t.y-n.y)*(n.x-r.x)>=e)return!1}return!0}}},726:(t,e,i)=>{const s=i(811),n=i(929),r=i(656);i(769);class a{static defaultOptions={substeps:3,velocityIterations:2,positionIterations:3,constraintIterations:1,slop:1,overlapMargin:0,positionWarming:.8,positionDampen:.9};delta=1;inverseDelta=1;substeps;velocityIterations;positionIterations;constraintIterations;slop;overlapMargin;positionWarming=.8;positionDampen;constructor(t,e={}){let i={...a.defaultOptions};n.merge(i,e,1),e=i;let s=["substeps","velocityIterations","positionIterations","constraintIterations","slop","positionDampen"];for(let t of s)null!=e[t]&&"function"!=typeof this[t]&&(this[t]=e[t]);this.World=t,this.Performance=new r}update(t=void 0){const{World:e,Performance:i,substeps:s}=this,{rigidBodies:n}=e;void 0===t&&(t=i.delta*e.timescale),e.time+=t,t/=s,this.delta=t,this.inverseDelta=1/this.delta,i.update(),i.frame++;for(let i=0;i<s;i++){e.globalVectors.length=0,e.globalPoints.length=0;const r=e.collisionPairs;for(let t=0;t<r.length;t++){let[e,i]=r[t];this.collides(e,i)&&this.#x(e,i)}let a=Math.min(30,.5*this.inverseDelta);this.prepareContacts(t,a);for(let e of n)e._preUpdate(t);for(let t=0;t<this.velocityIterations;t++)this.solveVelocity(!0),this.solveVelocity(!1);if(this.positionIterations>0){this.preSolvePosition();for(let t=0;t<this.positionIterations;t++)this.solvePosition();this.postSolvePosition()}let o=i+1==s;for(let e of n)e._update(t,o)}this.delta=t*s,this.inverseDelta=1/this.delta}collides(t,e){if(t.parentNode.isStatic&&e.parentNode.isStatic)return!1;let i=!0,s=this.overlapMargin;function n(t,e){let i=t.vertices,s=-1/0,n=1/0;for(let t=0;t<i.length;t++){let r=e.dot(i[t]);r>s&&(s=r),r<n&&(n=r)}return{max:s,min:n}}if(t._lastSeparations[e.id]){let r=t._lastSeparations[e.id],a=n(t,r),o=n(e,r);Math.min(a.max-o.min,o.max-a.min)<s?i=!1:(delete t._lastSeparations[e.id],delete e._lastSeparations[t.id])}if(i){for(let r=0;r<t._axes.length;r++){let a=t._axes[r],o=n(t,a),l=n(e,a);if(Math.min(o.max-l.min,l.max-o.min)<s){i=!1,t._lastSeparations[e.id]=a,e._lastSeparations[t.id]=a;break}}for(let r=0;r<e._axes.length;r++){let a=e._axes[r],o=n(e,a),l=n(t,a);if(Math.min(o.max-l.min,l.max-o.min)<s){i=!1,t._lastSeparations[e.id]=a,e._lastSeparations[t.id]=a;break}}}return i}#x(t,e){const{World:i,Performance:r}=this;let a,o,l,h,d=1/0,c=[],[u,p,f,g]=this.#v(t,e),[y,m,x,v]=this.#v(e,t);if(p<=m?(d=p,a=f,h=t,l=e,o=t.vertices[v]):(d=m,a=x,h=e,l=t,o=e.vertices[g]),c.push(...u,...y),0===c.length&&c.push({vertice:new s(t.position),incidentBody:t,referenceBody:e,normalImpulse:0,tangentImpulse:0}),void 0===a)throw console.error(t,e),new Error("Could not find normal");a.mult2(-1),i.globalVectors.push({position:o,vector:new s(a)}),i.globalPoints.push(...c.map((t=>t.vertice)));for(let t of c){let e=t.vertice.sub(h.parentNode.position),i=t.vertice.sub(l.parentNode.position);t.anchorA=e.rotate(-h.parentNode.angle),t.anchorB=i.rotate(-l.parentNode.angle)}let w=n.pairCommon(t.id,e.id),b={bodyA:h,bodyB:l,anchorA:h.vertices[h===t?v:g],anchorB:l.vertices[l===t?v:g],depth:d,penetration:a.mult(d),contacts:c,normal:a,tangent:a.normal(),friction:Math.sqrt(l.parentNode.friction**2+h.parentNode.friction**2),restitution:1+Math.max(l.parentNode.restitution,h.parentNode.restitution),id:w,frame:r.frame,start:i.time};if(i.pairs[w]){let s=i.pairs[w];s.anchorA=b.anchorA,s.anchorB=b.anchorB,s.depth=b.depth,s.penetration=b.penetration,s.contacts=b.contacts,s.normal=b.normal,s.tangent=b.tangent,s.frame=b.frame,t.parentNode.trigger("bodyInside",e.parentNode,s),e.parentNode.trigger("bodyInside",t.parentNode,s)}else t.parentNode.trigger("bodyEnter",e.parentNode,b),e.parentNode.trigger("bodyEnter",t.parentNode,b),t.pairs.push(w),e.pairs.push(w);i.pairs[w]=b}#v(t,e){let i,s=[],n=1/0,r=this.overlapMargin,a=0,o=t.vertices;for(let l=0;l<o.length;l++){let h=o[l],d=o[(l+1)%o.length],c=h.sub(d).normal().normalize(),[u,p]=e._getSupport(c,h);e.containsPoint(h,r)&&s.push({vertice:h,incidentBody:t,referenceBody:e,normalImpulse:0,tangentImpulse:0}),p<n&&(n=p,i=c.mult(-1),a=u)}return[s,n,i,a]}cleansePair(t){const{Performance:e,World:i}=this;if(t.frame<e.frame){let{bodyA:e,bodyB:s}=t;return e.pairs.splice(e.pairs.indexOf(t.id),1),s.pairs.splice(s.pairs.indexOf(t.id),1),delete i.pairs[t.id],e.trigger("bodyExit",s,t),s.trigger("bodyExit",e,t),!0}return!1}prepareContacts(t,e){let{pairs:i}=this.World,s=Object.keys(i);for(let n=s.length;n--;){let r=i[s[n]];const{bodyA:a,bodyB:o,normal:l,tangent:h,contacts:d,depth:c}=r,u=c,p=a.parentNode,f=o.parentNode,{_inverseMass:g,_inverseInertia:y,position:m,velocity:x,angle:v}=p,{_inverseMass:w,_inverseInertia:b,position:M,velocity:S,angle:C}=f;let I=0===g||0===w?2*e:e;for(let e of d){e.normalImpulse=0,e.tangentImpulse=0;let i=e.anchorA.rotate(v),s=e.anchorB.rotate(C);e.adjustedSeparation=u+s.add(M).sub(i.add(m)).dot(l);let n=g+w+y*i.cross(l)**2+b*s.cross(l)**2;e.normalMass=n>0?1/n:0;let r=g+w+y*i.cross(h)**2+b*s.cross(h)**2;e.tangentMass=r>0?1/r:0;const a=10;let o=2*Math.PI*I,d=t*o*(2*a+t*o);e.biasCoefficient=o/(2*a+t*o),e.impulseCoefficient=1/(1+d),e.massCoefficient=d*e.impulseCoefficient}}}solveVelocity(t){let{pairs:e}=this.World,i=Object.keys(e);const r=this.inverseDelta,a=this.delta,o=this.slop;let l,h,d,c,u,p,f,g,y,m,x,v,w,b,M,S;for(let C=i.length;C--;){let I=e[i[C]];if(!I||this.cleansePair(I))continue;const{bodyA:P,bodyB:A,normal:k,tangent:N,contacts:E,friction:T,restitution:R}=I,_=P.parentNode,O=A.parentNode;if(0!==E.length&&!_.isSensor&&!O.isSensor){l=_._inverseMass,d=_._inverseInertia,u=_.angularVelocity,f=_.velocity,x=u,y=new s(f),w=_.angle,h=O._inverseMass,c=O._inverseInertia,p=O.angularVelocity,g=O.velocity,v=p,m=new s(g),b=O.angle;for(let e=E.length;e--;){let i=E[e];M=i.anchorA,S=i.anchorB;const s=M.rotate(w),C=S.rotate(b),I=f.add(s.cross(u)),P=g.add(C.cross(p)),A=P.sub(I).dot(k),B=P.sub(I).dot(N);if(A<0)continue;let z=g.sub(f).add(C.sub(s)).dot(k)*a+i.adjustedSeparation;if(z=(Math.abs(z)-o)*Math.sign(z),z<0)continue;let G=0,D=1,V=0;const W=100;z<0?G=z*r:t&&(G=Math.min(i.biasCoefficient*z,W),D=i.massCoefficient,V=i.impulseCoefficient),(_.isStatic||O.isStatic)&&(G*=2);let F=i.normalMass*D*(A*R+G)-V*i.normalImpulse,q=-i.tangentMass*B;{let t=Math.max(i.normalImpulse+F,0);F=t-i.normalImpulse,i.normalImpulse=t}{const t=T*i.normalImpulse;let e=n.clamp(i.tangentImpulse+q,-t,t);q=e-i.tangentImpulse,i.tangentImpulse=e}let L=k.mult(F).sub2(N.mult(q));y.add2(L.mult(l)),x+=d*s.cross(L),m.sub2(L.mult(h)),v-=c*C.cross(L)}_.isStatic||(f.set(y),_.angularVelocity=x),O.isStatic||(g.set(m),O.angularVelocity=v)}}}preSolvePosition(){const{World:t}=this;let{pairs:e}=t,i=Object.keys(e);for(let t=i.length;t--;){let s=e[i[t]],n=s.contacts.length;s.bodyA.parentNode.totalContacts+=n,s.bodyB.parentNode.totalContacts+=n}}solvePosition(){const{World:t,slop:e,positionDampen:i}=this;let{pairs:s}=t,n=Object.keys(s);for(let t=n.length;t--;){let r=s[n[t]],{bodyA:a,bodyB:o,normal:l,anchorA:h,anchorB:d}=r,c=r.depth=d.sub(h).dot(l);if(c<0)continue;let u=a.parentNode,p=o.parentNode;if(u.isSensor||p.isSensor)continue;let f=c+l.dot(p.positionImpulse.sub(u.positionImpulse));if(f<0)continue;let g=Math.max(f-e,0);if((u.isStatic||p.isStatic)&&(g*=2),!u.isStatic){let t=i/u.totalContacts;u.positionImpulse.add2(l.mult(g*t))}if(!p.isStatic){let t=i/p.totalContacts;p.positionImpulse.add2(l.mult(-g*t))}}}postSolvePosition(){const{World:t,positionWarming:e}=this;let{rigidBodies:i}=t;for(let t of i){t.totalContacts=0;let{positionImpulse:i,velocity:s}=t;0===i.x&&0===i.y||t.translate(i),i.dot(s)<0?(i.x=0,i.y=0):i.mult2(e)}}}t.exports=a},301:(t,e,i)=>{const s=i(811),n=i(593),r=i(929),a=i(219),o=i(416),l=i(281),h=i(506),d=i(769),c=i(371);class u extends n{static defaultOptions={mass:1,restitution:4,frictionAir:.05,frictionAngular:.01,friction:.1,round:0,roundQuality:40,isStatic:!1,isSensor:!1,hasCollisions:!0,collisionFilter:{layer:16777215,mask:16777215}};static roundVertices(t,e,i=40){let s=[],n=t.length;for(let r=0;r<n;r++){let a=t[(r-1+n)%n],o=t[r],l=t[(r+1)%n],d=o.sub(a),c=l.sub(o),u=d.normalize(),p=c.normalize(),f=Math.min(e,d.length/2),g=Math.min(e,c.length/2),y=Math.min(f,g),m=u.mult(-y).add(o),x=u.mult(.5*-y).add(o),v=p.mult(.5*y).add(o),w=p.mult(y).add(o),b=new h(m,x,v,w);for(let t=0;t<b.length;)s.push(b.get(t)),t+=i;s.push(w)}return s}nodeType="RigidBody";vertices=[];mass=1;restitution=.1;frictionAir=.05;frictionAngular=.01;friction=.1;round=0;roundQuality=20;isStatic=!1;isSensor=!1;hasCollisions=!0;collisionFilter={layer:16777215,mask:16777215};constructor(t,e,i,n={}){super(),i=new s(i);let{Engine:a}=t;this.Game||(this.Game=t),this.Engine||(this.Engine=a),this.World=this.Engine.World,delete n.World,n.render&&(this.addChild(n.render),delete n.render),"object"==typeof n.collisionFilter&&r.merge(this.collisionFilter,n.collisionFilter,1),r.merge(this,n,1);for(let t in["layer","mask"])"string"==typeof this.collisionFilter[t]&&(this.collisionFilter[t]=parseInt(this.collisionFilter[t],2));this.vertices=e.map((t=>new s(t))),n.round&&n.round>0&&(this.vertices=u.roundVertices(this.vertices,this.round,this.roundQuality)),this.#u(),this._resetVertices();let o=[this.vertices];this.#w()||(o=this.#b());for(let t of o){let e=new d(this,t,this.Engine);this.addChild(e)}this._resetVertices(),this._updateInertia(),this._inverseMass=1/this.mass,n.angle&&(this.angle=0,this.setAngle(n.angle)),this.setPosition(i)}add(){let t=this.Engine.World;return this.isAdded()||(super.add(),t.addChild(this)),this}delete(){let t=this.Engine.World;return this.isAdded()&&(super.delete(),t.removeChild(this)),this}addPolygonRender(t,e=this.Game.Render.app.stage){let i=new a({container:e,position:new s(this.position),vertices:this.vertices,angle:this.angle,...t});return this.isAdded()&&i.add(),this.addChild(i),this.polygonRender=i,this}addSprite(t,e=this.Game.Render.app.stage){let i=new o({container:e,position:new s(this.position),angle:this.angle,...t});return this.isAdded()&&i.add(),this.addChild(i),this.sprite=i,this}addSpritesheet(t,e){let i=new l({container:t,position:new s(this.position),angle:this.angle,...e});return this.spritesheet=i,this.isAdded()&&i.add(),this.addChild(i),this}setStatic(t){let{dynamicGrid:e,staticGrid:i}=this.Engine.World,s=this.isStatic;t!==s&&(this.isStatic=t,this.mass=1/0,this.inertia=1/0,this._inverseMass=0,this._inverseInertia=0,this.hasCollisions&&this.isAdded()&&(s?i.removeBody(this):e.removeBody(this),t?i.addBody(this):e.addBody(this)))}setMass(t){this.mass=t,this._inverseMass=1/this.mass,this._updateInertia()}setCollisions(t){let{dynamicGrid:e,staticGrid:i}=this.Engine.World;t!==this.hasCollisions&&(this.hasCollisions=t,this.hasCollisions?this.isStatic?i.addBody(this):e.addBody(this):this.isStatic?i.removeBody(this):e.removeBody(this))}containsPoint(t){for(let e of this.children)if(e instanceof d&&e.containsPoint(t))return!0;return!1}setPosition(t){if(!t instanceof s)throw new Error("position must be a vec");let e=t.sub(this.position);this.translate(e)}setVelocity(t){if(!t instanceof s)throw new Error("velocity must be a vec");if(t.isNaN())throw console.error(t),new Error("velocity is NaN");this.isStatic||this.velocity.set(t)}setAngularVelocity(t){if(isNaN(t))throw console.error(t),new Error("angular velocity is NaN");this.isStatic||(this.angularVelocity=t)}applyForce(t,e=this.Engine.delta){if(!t instanceof s)throw new Error("force must be a vec");t.isNaN()||this.isStatic||this.force.add2(t.mult(e))}applyTorque(t,e=this.Engine.delta){isNaN(t)||(this.torque+=t*e)}Engine;position=new s(0,0);velocity=new s(0,0);angle=0;angularVelocity=0;_last={velocity:new s(0,0),angularVelocity:0};force=new s(0,0);impulse=new s(0,0);positionImpulse=new s(0,0);torque=0;totalContacts=0;rotationPoint=new s(0,0);_inverseMass=1;inertia=1;_inverseInertia=15e-6;#i={bodyEnter:[],bodyInside:[],bodyExit:[],beforeUpdate:[],duringUpdate:[],add:[],delete:[]};on(t,e){this.#i[t]?this.#i[t].push(e):console.warn(t+" is not a valid event")}off(t,e){let i=this.#i[t];i.includes(e)&&i.splice(i.indexOf(e),1)}trigger(t,...e){this.#i[t]?this.#i[t].forEach((t=>{t(...e)})):console.warn(t+" is not a valid event")}_preUpdate(t){this.trigger("beforeUpdate"),this.isStatic||(this.velocity.add2(this.force.mult(this._inverseMass)).add2(this.Engine.World.gravity.mult(t)),this.angularVelocity+=this.torque*this._inverseInertia,this.force.x=0,this.force.y=0,this.torque=0)}_update(t,e=!0){if(this.trigger("duringUpdate"),this.isStatic)return;let{velocity:i,angularVelocity:s}=this._last,n=(1-this.frictionAir)**t,r=(1-this.frictionAngular)**t;if(!this.velocity.isNaN()&&!isNaN(t+n+r)){if(this.velocity.mult2(n),0===this.velocity.x&&0===this.velocity.y||this.translate(this.velocity.add(i).mult(t/2)),this._last.velocity.set(this.velocity),this.angularVelocity*=r,this.angularVelocity){let e=(this.angularVelocity+s)*t/2,i=this.rotationPoint.rotate(this.angle+e).add(this.position);this.translateAngle(e,i,!1)}if(this._last.angularVelocity=this.angularVelocity,e&&this.hasCollisions)for(let t of this.children)t instanceof d&&this.Engine.World.dynamicGrid.updateBody(t)}}#g(){let t=0,e=this.vertices,i=e.length;for(let s=0;s<i;s++)t+=e[s].cross(e[(s+1)%i]);return.5*t}#u(t=1){let e=this.vertices;for(let i=0;i<e.length;i++){let s=e[i];for(let n=0;n<e.length;n++){if(n===i)continue;let r=e[n],a=s.sub(r);if(Math.abs(a.x)+Math.abs(a.y)<t){e.splice(i,1),i--;break}}}}#M(){const{vertices:t,mass:e}=this;if(this.isStatic)return 1/0;let i=0,s=0;for(var n=0;n<t.length;n++){let e=(n+1)%t.length,r=Math.abs(t[e].cross(t[n]));i+=r*(t[e].dot(t[e])+t[e].dot(t[n])+t[n].dot(t[n])),s+=r}return e/6*(i/s)}_updateInertia(){this.isStatic?(this.mass=1/0,this.inertia=1/0,this._inverseMass=0,this._inverseInertia=0):(this.inertia=this.#M(),this._inverseInertia=1/this.inertia)}#w(){let t=this.vertices,e=t.length,i=t[0].sub(t[1]),s=0;for(let n=1;n<e;n++){let r=t[n].sub(t[(n+1)%e]),a=Math.sign(r.cross(i));if(0===s)s=a;else if(0!==a&&s!==a)return!1;i=r}return!0}#b(){let t=[],e=this.vertices.map((t=>t.toArray()));c.makeCCW(e);let i=c.quickDecomp(e);for(let e=0;e<i.length;e++)t.push(i[e].map((t=>new s(t))));return t}#m(){return r.getCenterOfMass(this.vertices)}#y(){let t=this.#m(),e=this.position;t.sub2(e);for(let e=0;e<this.vertices.length;e++)this.vertices[e].sub2(t)}_resetVertices(t=!1){this.#f(t),this.area=this.#g(),this.#y()}#f(t=!1){if(t){let t=this.vertices,e=this.position,i=t.map((t=>[t,t.sub(e).angle]));i.sort(((t,e)=>r.angleDiff(t[1],e[1]))),this.vertices=i.map((t=>t[0]))}else{let t=this.vertices,e=this.position,i=t.map((t=>t.sub(e).angle));r.angleDiff(i[0],i[1])>0&&this.vertices.reverse()}}}t.exports=u},458:(t,e,i)=>{const s=i(811),n=i(847),{angleDiff:r}=i(929);t.exports=class{position=new s(0,0);fov=2e3;translation=new s(0,0);scale=1;boundSize=1e3;Render=null;constructor(t){this.Render=t}setPosition(t){this.position.set(t)}setFov(t){this.fov=t}screenPtToGame(t){let{scale:e,translation:i}=this,n=this.Render._parentBoundingBox,r=new s(n.left-window.scrollX,n.top-window.scrollY);return new s((t.x-i.x-r.x)/e,(t.y-i.y-r.y)/e)}gamePtToScreen(t){let{scale:e,translation:i}=this,n=this.Render._parentBoundingBox,r=new s(n.left-window.scrollX,n.top-window.scrollY);return new s(t.x*e+i.x+r.x,t.y*e+i.y+r.y)}async shake(t=30,e=1,i=n.ease.out.cubic,a=void 0){a&&(a?.normalize2(),a.y*=-1);let o=.01,l=t,h=new n({duration:e,curve:i,ontick:e=>{l=t*(1-e),o=.01+.05*e}});function d(t){return a?a.mult(-Math.sign(a.dot(new s(t)))).angle:(r(t,Math.random()*Math.PI+Math.PI)+2*Math.PI)%Math.PI*2}h.run();let c=new s(0,0),u=d(Math.random()*Math.PI*2);for(;h.isRunning()&&e-h.getTime()>o;){let t=o,e=d(u);u=e;let i=new s(Math.cos(e)*l,Math.sin(e)*l),r=new s(c),a=i.sub(r);await new n({duration:t,curve:n.ease.linear,ontick:t=>{this.position.sub2(c),c.set(a.mult(t).add(r)),this.position.add2(c)}}).run()}let p=new s(c),f=c.mult(-1);await new n({duration:o,curve:n.ease.linear,ontick:t=>{this.position.sub2(c),c.set(f.mult(t).add(p)),this.position.add2(c)}}).run()}}},334:(t,e,i)=>{i(830);const s=i(769),{createElement:n}=i(794);t.exports=class{canvas=null;ctx=null;enabled={wireframes:!1,centers:!1,collisions:!1,broadphase:!1,boundingBox:!1};constructor(t){this.Game=t;let e=t.Render.app.view,i=this.canvas=n("canvas",{parent:e.parentNode,width:e.width,height:e.height,style:{position:"absolute",zIndex:1,top:e.offsetTop+"px",left:e.offsetLeft+"px",width:e.style.width,height:e.style.height,background:"transparent",pointerEvents:"none",margin:0}});this.ctx=i.getContext("2d"),t.Render.app.renderer.on("resize",(()=>{let s=t.Render.app.view;i.width=s.width,i.height=s.height,i.style.width=s.style.width,i.style.height=s.style.height,i.style.top=e.offsetTop+"px",i.style.left=e.offsetLeft+"px"})),this.update=this.update.bind(this),t.Render.app.ticker.add(this.update)}update(){let{ctx:t,canvas:e,enabled:i,Game:s}=this;const{Render:n}=s,{camera:r,pixelRatio:a}=n;let o=e.width,l=e.height;const{position:h}=r,d=r.scale*a;let c=new vec({x:-h.x*d+o/2,y:-h.y*d+l/2});t.clearRect(0,0,o,l),this.trigger("beforeSave"),t.save(),t.translate(c.x,c.y),t.scale(d,d),this.trigger("beforeRender");for(let t in i)i[t]&&"function"==typeof this[t]&&this[t]();this.trigger("afterRender"),t.restore(),this.trigger("afterRestore")}wireframes(){const{Game:t,ctx:e}=this,{camera:i,pixelRatio:n}=t.Render,r=i.scale*n;function a(t){e.moveTo(t[0].x,t[0].y);for(let i=0;i<t.length;i++)if(i>0){let s=t[i];e.lineTo(s.x,s.y)}e.closePath()}e.beginPath();let o=t.World.rigidBodies;for(let t of o)for(let e of t.children)e instanceof s&&a(e.vertices);e.lineWidth=2/r,e.strokeStyle="#DF7157",e.stroke()}collisions(){const{ctx:t,Game:e}=this,{globalPoints:i,globalVectors:s}=e.World;if(i.length>0){t.beginPath();for(let e=0;e<i.length;e++){let s=i[e];t.moveTo(s.x,s.y),t.arc(s.x,s.y,2.5/camera.scale,0,2*Math.PI),t.fillStyle="#e8e8e8"}t.fill()}if(s.length>0){t.beginPath();for(let e=0;e<s.length;e++){let i=s[e].position,n=s[e].vector;t.moveTo(i.x,i.y),t.lineTo(i.x+10*n.x/camera.scale,i.y+10*n.y/camera.scale),t.strokeStyle="#DF7157",t.lineWidth=3/camera.scale}t.stroke()}}centers(){const{ctx:t,Game:e}=this,{camera:i}=e.Render;t.fillStyle="#DF7157";let s=e.World.rigidBodies;t.beginPath();for(let e of s)t.moveTo(e.position.x,e.position.y),t.arc(e.position.x,e.position.y,2/i.scale,0,2*Math.PI);t.fill()}boundingBox(){const{ctx:t,Game:e}=this,{World:i,Render:n}=e,{camera:r}=n;let a=i.rigidBodies,o=i.constraints;t.strokeStyle="#66666680",t.lineWidth=1/r.scale;for(let e of a)for(let i of e.children)if(i instanceof s){let e=i.bounds,s=e.max.x-e.min.x,n=e.max.y-e.min.y;t.beginPath(),t.strokeRect(e.min.x,e.min.y,s,n)}t.strokeStyle="#66666630";for(let e of o){let i=e.bounds,s=i.max.x-i.min.x,n=i.max.y-i.min.y;t.beginPath(),t.strokeRect(i.min.x,i.min.y,s,n)}}broadphase(t=this.Game.World.dynamicGrid){const{ctx:e,Game:i}=this,{camera:s}=i.Render;let n=t.gridSize;e.lineWidth=.4/s.scale,e.strokeStyle="#D0A356",e.fillStyle="#947849",Object.keys(t.grid).forEach((i=>{let s=t.grid[i],r=t.unpair(i).mult(n);e.strokeRect(r.x,r.y,n,n),e.globalAlpha=.003*s.length,e.fillRect(r.x,r.y,n,n),e.globalAlpha=1}))}arrow(t,e,i=6){let s=this.ctx,n=new vec(t.x+e.x,t.y+e.y),r=e.rotate(3*Math.PI/4).normalize2().mult(i),a=r.reflect(e.normalize());s.moveTo(t.x,t.y),s.lineTo(n.x,n.y),s.lineTo(n.x+r.x,n.y+r.y),s.moveTo(n.x,n.y),s.lineTo(n.x+a.x,n.y+a.y)}#i={beforeSave:[],beforeRender:[],afterRender:[],afterRestore:[]};on(t,e){this.#i[t]?this.#i[t].push(e):console.warn(t+" is not a valid event")}off(t,e){let i=this.#i[t];i.includes(e)&&i.splice(i.indexOf(e),1)}trigger(t,...e){this.#i[t]&&this.#i[t].forEach((t=>{t(...e)}))}}},141:(t,e,i)=>{const s=i(811),{merge:n}=i(929),r=i(223);class a{static defaultOptions={title:"",titleSize:14,titleColor:"white",anchorX:"left",anchorY:"top",background:"#0D0D0DE6",maxLength:200,scaleRange:100,lineColor:"#9C9C9C",lineWidth:1,padding:8,round:5};enabled=!0;canvas;ctx;data={};constructor(t=200,e=200,i=new s(0,0),r={}){let o={...a.defaultOptions};n(o,r,1);let{anchorX:l,anchorY:h}=o;"string"==typeof o.lineColor&&(o.lineColor={default:o.lineColor}),n(this,o,1),this.width=t,this.height=e;let d=this.scale=devicePixelRatio??1,c=this.canvas=document.createElement("canvas");this.ctx=c.getContext("2d"),c.style.position="absolute",c.style.zIndex="2","center"===l?(c.style.left=`calc(50vw + ${i.x}px)`,c.style.transform="translateX(-50%)"):c.style[l]=`${i.x}px`,"center"===h?(c.style.top=`calc(50vh + ${i.y}px)`,c.style.transform="translateY(-50%)"):c.style[h]=`${i.y}px`,c.style.transformOrigin=`${l} ${h}`,c.style.transform+=` scale(${1/d}, ${1/d})`,c.style.top=`${i.x}px`,c.width=d*t,c.height=d*e,c.style.background="transparent",document.body.appendChild(c),this.update=this.update.bind(this),this.enabled&&(this.animationFrame=requestAnimationFrame(this.update))}setEnabled(t){this.enabled=t,null!=this.animationFrame&&(cancelAnimationFrame(this.animationFrame),delete this.animationFrame),this.enabled?(this.canvas.style.display="block",this.update()):this.canvas.style.display="none"}_getStats(t){let e=0,i=1/0,s=(()=>{let s=0;for(let n=0;n<t.length;n++){let r=t[n];s+=r,e=Math.max(e,r),i=Math.min(i,r)}return s/t.length})();return{max:e,min:i,average:s}}update(){let{canvas:t,ctx:e,enabled:i,scale:n,width:a,height:o,title:l,titleSize:h,titleColor:d,background:c,round:u,padding:p,lineColor:f,lineWidth:g,maxLength:y,scaleRange:m}=this,{data:x}=this;if(e.clearRect(0,0,t.width,t.height),i){e.save(),e.scale(n,n),e.beginPath(),r.roundedRect(a,o,new s(a/2,o/2),u,e),e.fillStyle=c,e.fill(),e.beginPath(),e.fillStyle=d,e.textAlign="left",e.font=`400 ${h}px Arial`,e.fillText(l,p,p+h-4);let v={min:1/0,max:-1/0};if(Array.isArray(m))v={min:m[0],max:m[1]};else{for(let S of Object.values(x)){let{min:C,max:I}=this._getStats(S);v.min=Math.min(v.min,C),v.max=Math.max(v.max,I)}v.min=Math.min(v.min,(v.max+v.min-m)/2),v.max=Math.max(v.max,(v.max+v.min+m)/2)}let w={min:new s(p,h+p+5),max:new s(a-p,o-p)},b=w.max.sub(w.min);function M(t,e){const i=v.max-v.min;return[w.min.x+e/y*b.x,w.max.y-(t-v.min)/i*b.y]}for(let P in x){let A=x[P],k=f[P];if(A.length>1){e.beginPath(),e.moveTo(...M(A[0],0));for(let N=1;N<A.length;N++)e.lineTo(...M(A[N],N));e.lineWidth=g,e.lineJoin="bevel",e.strokeStyle=k,e.stroke()}}e.restore(),this.animationFrame=requestAnimationFrame(this.update)}}addData(t,e="default"){if(!this.lineColor[e])throw console.error(this.lineColor),new Error(`No data named ${e} in graph`);this.data[e]||(this.data[e]=[]);let i=this.data[e];for(i.push(t);i.length>0&&i.length>this.maxLength;)i.shift()}}t.exports=a},763:(t,e,i)=>{const s=i(223),n=i(811);t.exports=class{enabled=!1;canvas;ctx;position=new n(20,20);constructor(t,e){this.Performance=t;let i=e.app.view;const s=this.width=100,n=this.height=50;let r=this.scale=devicePixelRatio??1,a=this.canvas=document.createElement("canvas");this.ctx=a.getContext("2d"),a.style.position="absolute",a.style.zIndex="2",a.style.top="20px",a.style.right="0px",a.style.left="unset",a.width=r*s,a.height=r*n,a.style.background="transparent",a.style.pointerEvents="none",a.style.transformOrigin="top left",a.style.transform=`scale(${1/r}, ${1/r})`,i.parentNode.appendChild(a),this.update=this.update.bind(this),e.app.ticker.add(this.update)}update(){let{canvas:t,ctx:e,enabled:i,Performance:r,scale:a,width:o,height:l}=this,{history:h}=r;if(e.clearRect(0,0,t.width,t.height),i){e.save(),e.scale(a,a),e.beginPath(),s.roundedRect(o,l,new n(o/2,l/2),5,e),e.fillStyle="#0D0D0De6",e.fill();let d=0,c=1/0,u=(()=>{let t=0;for(let e=0;e<h.fps.length;e++){let i=h.fps[e];t+=i,d=Math.max(d,i),c=Math.min(c,i)}return t/h.fps.length})(),p=(()=>{let t=0,e=Math.min(h.fps.length,20);for(let i=0;i<e;i++)t+=h.fps[i];return t/e})();if(e.beginPath(),e.fillStyle="white",e.textAlign="right",e.font="400 12px Arial",e.fillText(`${Math.round(p)} fps`,o-12,17),h.fps.length>10){let y=100,m={min:Math.max(0,Math.min(c,u-y)),max:Math.max(d,u+y,60)};const x=m.max-m.min;let v={min:new n(10,18),max:new n(o-10,l-4)};function w(t,e){return[v.max.x-e/h.fps.length*(v.max.x-v.min.x),v.max.y-(t-m.min)/x*(v.max.y-v.min.y)]}e.beginPath(),e.moveTo(...w(h.fps[0],0));for(let b=1;b<h.fps.length;b++)e.lineTo(...w(h.fps[b],b));e.lineWidth=1,e.lineJoin="bevel",e.strokeStyle="#9C9C9C",e.stroke()}e.beginPath();let f=[[.75,"#3FF151"],[.5,"#F5ED32"],[.25,"#F89A2C"],[0,"#F74D4D"]],g=60;e.fillStyle="#808080";for(let M of f)if(u>=M[0]*g){e.fillStyle=M[1];break}s.roundedRect(6,6,new n(15,13),2,e),e.fill(),e.restore()}}}},219:(t,e,i)=>{const s=i(593),n=i(811),r=i(929);class a extends s{static defaultOptions={container:void 0,layer:0,position:new n(0,0),angle:0,subtype:"polygon",vertices:[],visible:!0,alpha:1,background:"transparent",border:"transparent",borderWidth:3,borderOffset:.5,lineCap:"butt",lineJoin:"miter",width:100,height:100,round:0,radius:50};static all=new Set;nodeType="PolygonRender";constructor(t={}){super();let e={...a.defaultOptions};r.merge(e,t,1),t=e,r.merge(this,t,1),this.#S()}#S(){let t=this.graphic=new PIXI.Graphics,{position:e,angle:i,subtype:s,vertices:a}=this,{layer:o,alpha:l,background:h,border:d,borderWidth:c,lineCap:u,lineJoin:p,borderOffset:f,round:g}=this,{parseColor:y}=r;if(h=y(h),h[1]>0&&t.beginFill(...h),d=y(d),d[1]>0&&t.lineStyle({width:c,color:d[0],alpha:d[1],cap:u,join:p,alignment:f}),"Rectangle"===s){let{width:e,height:i}=this;g>0?t.drawRoundedRect(-e/2,-i/2,e,i,g):t.drawRect(-e/2,-i/2,e,i)}else if("Circle"===s){let{radius:e}=this;t.drawCircle(0,0,e)}else{let e=r.getCenterOfMass(a);t.drawPolygon(a.map((t=>t.sub(e))))}d[1]>0&&t.closePath(),h[1]>0&&t.endFill(),t.zIndex=o;let m=new n(e);this.position=new n(0,0),this.translate(m),this.angle=0,this.translateAngle(i),this.setAlpha(l),this.trigger("load")}setLayer(t){this.layer=t,this.graphic.zIndex=t}setAlpha(t){this.alpha=t,this.graphic.alpha=t}setVisible(t){this.visible=t,this.graphic.visible=t}translate(t){super.translate(t);let{graphic:e}=this;e.position.x+=t.x,e.position.y+=t.y}translateAngle(t){let{graphic:e}=this;this.angle+=t,e.rotation+=t}add(){super.add(),a.all.add(this),this.container.addChild(this.graphic)}delete(){super.delete(),a.all.delete(this),this.container.removeChild(this.graphic)}destroy(){this.graphic.destroy()}#i={delete:[],add:[],load:[]};on(t,e){this.#i[t]?this.#i[t].push(e):console.warn(t+" is not a valid event")}off(t,e){(t=this.#i[t]).includes(e)&&t.splice(t.indexOf(e),1)}trigger(t){this.#i[t]&&this.#i[t].forEach((t=>{t()}))}}t.exports=a},681:(t,e,i)=>{const s=i(458),n=i(929),r=i(811);class a{static defaultOptions={background:"transparent",pixelRatio:window.devicePixelRatio??1,ySort:!1,parentElement:window,antialias:!0,scaleMode:PIXI.SCALE_MODES.LINEAR,getBoundSize:function(t,e){return Math.sqrt(t*e)||1}};app=null;camera=null;pixelRatio=1;parentElement=null;_parentBoundingBox;constructor(t={}){try{PIXI.settings}catch(t){throw new Error("PIXI is not defined\nHelp: try loading pixi.js before creating a ter app")}let e={...a.defaultOptions},i=t.parentElement??e.parentElement;i===window&&(i=document.body),this.parentElement=i,delete t.parentElement,n.merge(e,t,1),t=e;let{background:r,ySort:o,pixelRatio:l,antialias:h,getBoundSize:d,scaleMode:c}=t;this.camera=new s(this),this.getBoundSize=d,PIXI.settings.SCALE_MODE=c,PIXI.settings.RESOLUTION=this.pixelRatio=l,PIXI.Filter.defaultResolution=0,PIXI.Container.defaultSortableChildren=!0,r=n.parseColor(r);let u=this.app=new PIXI.Application({background:r[0],backgroundAlpha:r[1],resizeTo:i==document.body?window:i,antialias:h??!0});i.appendChild(u.view),u.ticker.add(this.update.bind(this)),u.stage.filters=[],u.stage.sortableChildren=!0,this.#C(u.screen.width,u.screen.height),u.renderer.on("resize",this.#C.bind(this)),o&&u.stage.on("sort",(function(t){t.zOrder=t.y}))}#I(t){let e;if(t===window||t===document.body){let t=this.app.view;e={width:window.innerWidth,height:window.innerHeight,top:t.offsetTop,left:t.offsetLeft}}else e={top:t.offsetTop,left:t.offsetLeft,width:t.offsetWidth,height:t.offsetHeight};return this._parentBoundingBox=e,e}#C(t,e){this.camera.boundSize=this.getBoundSize(t,e);let i=this.app.view,{width:s,height:n}=this.#I(this.parentElement);i.style.width=s+"px",i.style.height=n+"px"}setPixelRatio(t){this.pixelRatio=t,PIXI.settings.RESOLUTION=t,this.#C(this.app.screen.width,this.app.screen.height)}update(t){this.trigger("beforeUpdate");let{app:e,camera:i}=this,{stage:s}=e,{position:n,translation:a,fov:o,boundSize:l}=i,h=new r(e.screen.width,e.screen.height),d=l/o;a.set({x:-n.x*d+h.x/2,y:-n.y*d+h.y/2}),i.scale=l/o,s.x=a.x,s.y=a.y,s.scale.x=i.scale,s.scale.y=i.scale,this.trigger("afterUpdate")}#i={beforeUpdate:[],afterUpdate:[]};on(t,e){this.#i[t]?this.#i[t].push(e):console.warn(t+" is not a valid event")}off(t,e){(t=this.#i[t]).includes(e)&&t.splice(t.indexOf(e),1)}trigger(t){this.#i[t]&&this.#i[t].forEach((t=>{t()}))}}t.exports=a},223:t=>{let e={screenPtToGame:function(t,e){const{camera:i,pixelRatio:s}=e,{scale:n,translation:r}=i;return new vec((t.x*s-r.x)/n,(t.y*s-r.y)/n)},gamePtToScreen:function(t,e){const{camera:i,pixelRatio:s}=e,{scale:n,translation:r}=i;return new vec((t.x*n+r.x)/s,(t.y*n+r.y)/s)},roundedPolygon:function(t,e,i){if(t.length<3)return void console.warn("RenderMethods.roundedPolygon needs at least 3 vertices",t);function s(i){let s=t[i],n=t[(t.length+i-1)%t.length],r=t[(i+1)%t.length],a=n.sub(s),o=s.sub(r),l=a.length,h=o.length,d=Math.min(l/2,h/2,e),c=s,u=c.add(a.normalize().mult(d)),p=c.sub(o.normalize().mult(d));return[u,c,p]}let n=s(0);i.moveTo(n[0].x,n[0].y),i.quadraticCurveTo(n[1].x,n[1].y,n[2].x,n[2].y);for(let e=1;e<t.length;e++){let t=s(e);i.lineTo(t[0].x,t[0].y),i.quadraticCurveTo(t[1].x,t[1].y,t[2].x,t[2].y)}i.lineTo(n[0].x,n[0].y)},roundedPolygonCtx:function(t,e,i){if(t.length<3)return void console.warn("RenderMethods.roundedPolygon needs at least 3 vertices",t);function s(i){let s=t[i],n=t[(t.length+i-1)%t.length],r=t[(i+1)%t.length],a=n.sub(s),o=s.sub(r),l=a.length,h=o.length,d=Math.min(l/2,h/2,e),c=s,u=c.add(a.normalize().mult(d)),p=c.sub(o.normalize().mult(d));return[u,c,p]}let n=s(0);i.moveTo(n[0].x,n[0].y),i.quadraticCurveTo(n[1].x,n[1].y,n[2].x,n[2].y);for(let n=1;n<t.length;n++)if(0===e)i.lineTo(t[n].x,t[n].y);else{let t=s(n);i.lineTo(t[0].x,t[0].y),i.quadraticCurveTo(t[1].x,t[1].y,t[2].x,t[2].y)}i.closePath()},roundedRect:function(t,i,s,n,r){e.roundedPolygonCtx([new vec(-t/2,-i/2).add2(s),new vec(t/2,-i/2).add2(s),new vec(t/2,i/2).add2(s),new vec(-t/2,i/2).add2(s)],n,r)},arrow:function(t,e,i=10,s){let n=new vec(t.x+e.x,t.y+e.y),r=e.rotate(3*Math.PI/4).normalize2().mult(i),a=r.reflect(e.normalize());s.moveTo(t.x,t.y),s.lineTo(n.x,n.y),s.lineTo(n.x+r.x,n.y+r.y),s.moveTo(n.x,n.y),s.lineTo(n.x+a.x,n.y+a.y)}};t.exports=e},996:(t,e,i)=>{let s=t.exports;s.Polygon=i(219),s.Sprite=i(416)},416:(t,e,i)=>{const s=i(929),n=i(593),r=i(811);class a extends n{static imageDir="";static defaultOptions={container:void 0,layer:0,position:new r(0,0),angle:0,visible:!0,alpha:1,src:"",scale:new r(1,1),width:void 0,height:void 0};static all=new Set;loaded=!1;nodeType="Sprite";constructor(t){super();let e={...a.defaultOptions};s.merge(e,t,1),t=e,s.merge(this,t,1),this.src=a.imageDir+this.src,this.position=new r(this.position??{x:0,y:0}),this.add=this.add.bind(this),this.create()}create(){let{width:t,height:e,layer:i,position:s,angle:n,src:a}=this,o=this.sprite=PIXI.Sprite.from(a);this.loaded=!0,o.anchor.set(.5),null!=t&&null!=e&&this.setSize(t,e),this.setAlpha(this.alpha),this.setLayer(i);let l=new r(s);this.position.set(new r(0,0)),this.translate(l),this.angle=0,this.translateAngle(n),this.trigger("load")}setLayer(t){this.layer=t,this.loaded&&(this.sprite.zIndex=t)}setScale(t){if(this.scale.set(t),!this.loaded)return;let{sprite:e}=this;e.scale.set(this.scale.x,this.scale.y),this.setSize()}setSize(t,e){if(null!=t&&(this.width=t),null!=e&&(this.height=e),!this.loaded)return;let{sprite:i}=this;i.width=this.width*this.scale.x,i.height=this.height*this.scale.y}setAlpha(t){this.alpha=t,this.loaded&&(this.sprite.alpha=t)}setVisible(t){this.visible=t,this.loaded&&(this.sprite.visible=t)}translate(t){if(super.translate(t),!this.loaded)return;let{sprite:e}=this;e.position.x+=t.x,e.position.y+=t.y}translateAngle(t,e=this.position){if(super.translateAngle(t,e),!this.loaded)return;let{sprite:i}=this;i.rotation+=t}add(){this.sprite||!this.isAdded()?(super.add(),a.all.add(this),this.container.addChild(this.sprite)):this.on("load",this.add)}delete(){super.delete(),a.all.delete(this),this.container.removeChild(this.sprite),this.off("load",this.add)}destroy(){this.sprite.destroy()}#i={load:[],add:[],delete:[]};on(t,e){this.#i[t]?this.#i[t].push(e):console.warn(t+" is not a valid event")}off(t,e){(t=this.#i[t]).includes(e)&&t.splice(t.indexOf(e),1)}trigger(t){this.#i[t]&&this.#i[t].forEach((t=>{t()}))}}t.exports=a},281:(t,e,i)=>{const s=i(593),n=i(929),r=i(811);class a extends s{static all=new Set;static defaultOptions={container:void 0,layer:0,position:new r(0,0),angle:0,visible:!0,alpha:1,speed:1/6,src:"",animation:"",scale:new r(1,1),width:void 0,height:void 0};constructor(t){super();let e={...a.defaultOptions};n.merge(e,t,1),t=e,n.merge(this,t,1),this.position=new r(this.position??{x:0,y:0}),this.add=this.add.bind(this),this.create()}create(){let{width:t,height:e,layer:i,position:s,angle:n,src:a,animation:o}=this;const l=PIXI.Assets.cache.get(a).data.animations;if(!l[o])throw new Error("No animation of name "+o);const h=PIXI.AnimatedSprite.fromFrames(l[o]);h.animationSpeed=this.speed,this.sprite=h,this.loaded=!0,h.anchor.set(.5),null!=t&&null!=e&&this.setSize(t,e),this.setAlpha(this.alpha),this.setLayer(i);let d=new r(s);this.position.set(new r(0,0)),this.translate(d),this.angle=0,this.translateAngle(n),this.trigger("load")}add(){this.sprite||!this.isAdded()?(super.add(),this.container.addChild(this.sprite),a.all.add(this),this.sprite.play()):this.on("load",this.add)}delete(){super.delete(),a.all.delete(this),this.container.removeChild(this.sprite),this.sprite.stop(),this.off("load",this.add)}setSpeed(t){this.speed=t,this.sprite.animationSpeed=t}setLayer(t){this.layer=t,this.loaded&&(this.sprite.zIndex=t)}setScale(t){if(this.scale.set(t),!this.loaded)return;let{sprite:e}=this;e.scale.set(this.scale.x,this.scale.y),this.setSize()}setSize(t,e){if(null!=t&&(this.width=t),null!=e&&(this.height=e),!this.loaded)return;let{sprite:i}=this;i.width=this.width*this.scale.x,i.height=this.height*this.scale.y}setAlpha(t){this.alpha=t,this.loaded&&(this.sprite.alpha=t)}setVisible(t){this.visible=t,this.loaded&&(this.sprite.visible=t)}translate(t){if(super.translate(t),!this.loaded)return;let{sprite:e}=this;e.position.x+=t.x,e.position.y+=t.y}translateAngle(t,e=this.position){if(super.translateAngle(t,e),!this.loaded)return;let{sprite:i}=this;i.rotation+=t}destroy(){this.sprite.destroy()}#i={load:[],add:[],delete:[]};on(t,e){this.#i[t]?this.#i[t].push(e):console.warn(t+" is not a valid event")}off(t,e){(t=this.#i[t]).includes(e)&&t.splice(t.indexOf(e),1)}trigger(t){this.#i[t]&&this.#i[t].forEach((t=>{t()}))}}t.exports=a},627:(t,e,i)=>{let s=t.exports;s.Game=i(830),s.Common=i(929),s.Ticker=i(754),s.Performance=i(656),s.Node=i(593),s.World=i(569),s.Engine=i(726),s.Bodies=i(789),s.Render=i(996),s.RenderMethods=i(223),s.Graph=i(141),s.Sprite=i(416),s.Spritesheet=i(281),s.vec=i(811),s.Grid=i(953),s.Bezier=i(506),s.Bounds=i(60),s.Inputs=i(764),s.Animation=i(847),s.DiscreteAnimation=i(218)}},e={},function i(s){var n=e[s];if(void 0!==n)return n.exports;var r=e[s]={exports:{}};return t[s](r,r.exports,i),r.exports}(627);var t,e}));